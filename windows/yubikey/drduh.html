
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Shameless grab of the amazing guide by drduh on GitHub under the MIT licence">
      
      
      
        <link rel="canonical" href="https://documentation.frolov.eu/windows/yubikey/drduh.html">
      
      
        <link rel="prev" href="misc.html">
      
      
        <link rel="next" href="../../misc/index.html">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28+insiders-4.53.11">
    
    
      
        <title>drduh's Yubikey guide - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c0d16a3a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
        <script src="../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#purchase-yubikey" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4h-8l-2-2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2M2 6H0v14a2 2 0 0 0 2 2h18v-2H2V6Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              drduh's Yubikey guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/FlagHunter01/documentation.frolov.eu/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Documentation
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/index.html" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index.html" class="md-tabs__link">
          
  
    
  
  Windows

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../misc/index.html" class="md-tabs__link">
          
  
    
  
  Miscellaneous

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4h-8l-2-2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2M2 6H0v14a2 2 0 0 0 2 2h18v-2H2V6Z"/></svg>

    </a>
    Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FlagHunter01/documentation.frolov.eu/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Documentation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Windows
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Windows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Yubikey
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Yubikey
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gpg-ssh.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    SSH with GPG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="misc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Miscellaneous
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    drduh's Yubikey guide
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="drduh.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    drduh's Yubikey guide
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purchase-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purchase YubiKey
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare environment
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-software" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install software
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-gnupg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare GnuPG
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prepare GnuPG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Identity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expiration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Expiration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passphrase" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passphrase
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-certify-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Certify key
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-additional-uids-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add additional uids (optional)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add additional uids (optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rationale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rationale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Subkeys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify keys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backup-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backup keys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#export-public-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Export public key
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure YubiKey
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure YubiKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#change-pin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change PIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set attributes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transfer Subkeys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transfer Subkeys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signature-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encryption key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication key
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify transfer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finish-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finish setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using YubiKey
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using YubiKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryption" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encryption
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-touch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure touch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSH">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#replace-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Replace agents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-public-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Copy public key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-ssh-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Import SSH keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-agent-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH agent forwarding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSH agent forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-ssh-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use ssh-agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-sgpg-agentssh" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use S.gpg-agent.ssh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chained-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chained forwarding
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitHub
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gnupg-agent-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        GnuPG agent forwarding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GnuPG agent forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legacy-distributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Legacy distributions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chained-gnupg-agent-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chained GnuPG agent forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-multiple-yubikeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using multiple YubiKeys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email" class="md-nav__link">
    <span class="md-ellipsis">
      
        Email
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thunderbird" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thunderbird
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mailvelope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mailvelope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mutt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keyserver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Keyserver
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Updating keys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updating keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#renew-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Renew Subkeys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotate-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rotate Subkeys
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reset-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reset YubiKey
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-hardening" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional hardening
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional hardening">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#improving-entropy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Improving entropy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-kdf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable KDF
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Network considerations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternative-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternative solutions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../misc/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Miscellaneous
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miscellaneous
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Markdown
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Markdown
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/md/main.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Introcution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/md/mkdocs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    MkDocs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/gh/main.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purchase-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purchase YubiKey
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare environment
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-software" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install software
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-gnupg" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare GnuPG
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prepare GnuPG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Identity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expiration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Expiration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passphrase" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passphrase
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-certify-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Certify key
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-additional-uids-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add additional uids (optional)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add additional uids (optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rationale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rationale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Subkeys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify keys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backup-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backup keys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#export-public-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Export public key
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure YubiKey
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure YubiKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#change-pin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change PIN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set attributes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transfer Subkeys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transfer Subkeys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signature-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encryption key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication key
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-transfer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify transfer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finish-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finish setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using YubiKey
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using YubiKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#encryption" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encryption
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Signature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-touch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure touch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSH">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#replace-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Replace agents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-public-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Copy public key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-ssh-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Import SSH keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-agent-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH agent forwarding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSH agent forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-ssh-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use ssh-agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-sgpg-agentssh" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use S.gpg-agent.ssh
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chained-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chained forwarding
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitHub
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gnupg-agent-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        GnuPG agent forwarding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GnuPG agent forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legacy-distributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Legacy distributions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chained-gnupg-agent-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chained GnuPG agent forwarding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-multiple-yubikeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using multiple YubiKeys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email" class="md-nav__link">
    <span class="md-ellipsis">
      
        Email
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Email">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thunderbird" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thunderbird
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mailvelope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mailvelope
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mutt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keyserver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Keyserver
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Updating keys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updating keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#renew-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Renew Subkeys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotate-subkeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rotate Subkeys
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reset-yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reset YubiKey
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-hardening" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional hardening
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional hardening">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#improving-entropy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Improving entropy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-kdf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable KDF
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Network considerations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternative-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternative solutions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
    <li class="md-path__item">
      <a href="../../index.html" class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
    
    
      <li class="md-path__item">
        <a href="../index.html" class="md-path__link">
          
  <span class="md-ellipsis">
    Windows
  </span>

        </a>
      </li>
    
  

      
        
  
    
    
      <li class="md-path__item">
        <a href="index.html" class="md-path__link">
          
  <span class="md-ellipsis">
    Yubikey
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  
    
      
    
    <a href="https://github.com/FlagHunter01/documentation.frolov.eu/raw/main/docs/windows/yubikey/drduh.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


  <h1>drduh's Yubikey guide</h1>

<div class="admonition note">
<p class="admonition-title">This is not my work</p>
<p>I copied the content of <a href="http://drduh.github.io/YubiKey-Guide/">drduh's guide</a> under the MIT licence. </p>
<p>I did it because it fits perfectly my needs regarding Yubikeys and out of fear it would disappear without warning like the 3<sup>rd</sup> Epistle of Half-Life.</p>
<div class="highlight"><span class="filename">MIT licence</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>The MIT License (MIT)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Copyright (c) 2016 drduh
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Permission is hereby granted, free of charge, to any person obtaining a copy
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>of this software and associated documentation files (the &quot;Software&quot;), to deal
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>in the Software without restriction, including without limitation the rights
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>copies of the Software, and to permit persons to whom the Software is
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>furnished to do so, subject to the following conditions:
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>The above copyright notice and this permission notice shall be included in all
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>copies or substantial portions of the Software.
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>SOFTWARE.
</code></pre></div>
</div>
<hr />
<p>This is a guide to using <a href="https://www.yubico.com/products/identifying-your-yubikey/">YubiKey</a> as a <a href="https://security.stackexchange.com/questions/38924/how-does-storing-gpg-ssh-private-keys-on-smart-cards-compare-to-plain-usb-drives">smart card</a> for secure encryption, signature and authentication operations.</p>
<p>Keys stored on YubiKey are <a href="https://web.archive.org/web/20201125172759/https://support.yubico.com/hc/en-us/articles/360016614880-Can-I-Duplicate-or-Back-Up-a-YubiKey-">non-exportable</a>, unlike filesystem-based credentials, while remaining convenient for daily use. YubiKey can be configured to require a physical touch for cryptographic operations, reducing the risk of credential compromise.</p>
<h2 id="purchase-yubikey">Purchase YubiKey<a class="headerlink" href="#purchase-yubikey" title="Permanent link">⚓︎</a></h2>
<p><a href="https://www.yubico.com/store/compare/">Current YubiKeys</a> except the FIDO-only Security Key Series and Bio Series YubiKeys are compatible with this guide.</p>
<p><a href="https://support.yubico.com/hc/en-us/articles/360013723419-How-to-Confirm-Your-Yubico-Device-is-Genuine">Verify YubiKey</a> by visiting <a href="https://www.yubico.com/genuine/">yubico.com/genuine</a>. Select <em>Verify Device</em> to begin the process. Touch the YubiKey when prompted and allow the site to see the make and model of the device when prompted. This device attestation may help mitigate <a href="https://media.defcon.org/DEF%20CON%2025/DEF%20CON%2025%20presentations/DEF%20CON%2025%20-%20r00killah-and-securelyfitz-Secure-Tokin-and-Doobiekeys.pdf">supply chain attacks</a>.</p>
<p>Several portable storage devices (such as microSD cards) for storing encrypted backups are also recommended.</p>
<h2 id="prepare-environment">Prepare environment<a class="headerlink" href="#prepare-environment" title="Permanent link">⚓︎</a></h2>
<p>A dedicated, secure operating environment is recommended to generate cryptographic keys.</p>
<p>The following is a general ranking of environments least to most hospitable to generating materials:</p>
<ol>
<li>Public, shared or other computer owned by someone else</li>
<li>Daily-use personal operating system with unrestricted network access</li>
<li>Virtualized operating system with limited capabilities (using <a href="https://virt-manager.org/">virt-manager</a>, VirtualBox or VMware, for example)</li>
<li>Dedicated and hardened <a href="https://www.debian.org/">Debian</a> or <a href="https://www.openbsd.org/">OpenBSD</a> installation</li>
<li>Ephemeral <a href="https://www.debian.org/CD/live/">Debian Live</a> or <a href="https://tails.boum.org/index.en.html">Tails</a> booted without primary storage attached</li>
<li>Hardened hardware and firmware (<a href="https://www.coreboot.org/">Coreboot</a>, <a href="https://github.com/corna/me_cleaner">Intel ME removed</a>)</li>
<li>Air-gapped system without network capabilities, preferably ARM-based Raspberry Pi or other architecturally diverse equivalent</li>
</ol>
<p>Debian Live is used in this guide to balance usability and security, with some additional instructions for OpenBSD.</p>
<p>Download the latest image and signature files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">curl -fLO &quot;https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/SHA512SUMS&quot;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">curl -fLO &quot;https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/SHA512SUMS.sign&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">curl -fLO &quot;https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/$(awk &#39;/xfce.iso$/ {print $2}&#39; SHA512SUMS)&quot;</span>
</code></pre></div>
<p>Download the Debian signing public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="go">gpg --keyserver hkps://keyring.debian.org --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B</span>
</code></pre></div>
<p>If the public key cannot be received, use a different keyserver or DNS server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">gpg --keyserver hkps://keyserver.ubuntu.com:443 --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B</span>
</code></pre></div>
<p>Verify the signature:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="go">gpg --verify SHA512SUMS.sign SHA512SUMS</span>
</code></pre></div>
<p><code>gpg: Good signature from "Debian CD signing key &lt;debian-cd@lists.debian.org&gt;"</code> must appear in the output.</p>
<p>Verify the cryptographic hash of the image file matches the one in the signed file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">grep $(sha512sum debian-live-*-amd64-xfce.iso) SHA512SUMS</span>
</code></pre></div>
<p>See <a href="https://www.debian.org/CD/verify">Verifying authenticity of Debian CDs</a> for more information.</p>
<p>Connect a portable storage device and identify the disk label - this guide uses <code>/dev/sdc</code> throughout, but this value may differ on your system:</p>
<p><strong>Linux</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="go">usb-storage 3-2:1.0: USB Mass Storage device detected</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="go">sd 2:0:0:0: [sdc] Attached SCSI removable disk</span>
</code></pre></div>
<p>Copy the Debian image to the device:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="go">sudo dd if=debian-live-*-amd64-xfce.iso of=/dev/sdc bs=4M status=progress ; sync</span>
</code></pre></div>
<p><strong>OpenBSD</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="gp">$ </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n2
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="go">sd2 at scsibus4 targ 1 lun 0: &lt;TS-RDF5, SD Transcend, TS3A&gt; SCSI4 0/direct removable serial.0000000000000</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="go">sd2: 15193MB, 512 bytes/sector, 31116288 sectors</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="gp">$ </span>doas<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>debian-live-*-amd64-xfce.iso<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/rsd2c<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>4m
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="go">465+1 records in</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="go">465+1 records out</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="go">1951432704 bytes transferred in 139.125 secs (14026448 bytes/sec)</span>
</code></pre></div>
<p>Power off, remove internal hard drives and all unnecessary devices, such as the wireless card.</p>
<h2 id="install-software">Install software<a class="headerlink" href="#install-software" title="Permanent link">⚓︎</a></h2>
<p>Load the operating system and configure networking. Optional hardening steps related to networking can be found <a href="#network-considerations">below</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the screen locks on Debian Live, unlock with <code>user</code> / <code>live</code></p>
</div>
<p>Open terminal and install required software packages.</p>
<p><strong>Debian/Ubuntu</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="go">sudo apt update</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="go">sudo apt -y upgrade</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="go">sudo apt -y install \</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="go">  wget gnupg2 gnupg-agent dirmngr \</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="go">  cryptsetup scdaemon pcscd \</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="go">  yubikey-personalization yubikey-manager</span>
</code></pre></div>
<p><strong>OpenBSD</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="go">doas pkg_add gnupg pcsc-tools</span>
</code></pre></div>
<p><strong>macOS</strong></p>
<p>Download and install <a href="https://brew.sh/">Homebrew</a> and the following packages:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="go">brew install \</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="go">  gnupg yubikey-personalization ykman pinentry-mac wget</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An additional Python package dependency may need to be installed to use <a href="https://support.yubico.com/support/solutions/articles/15000012643-yubikey-manager-cli-ykman-user-guide"><code>ykman</code></a> - <code>pip install yubikey-manager</code></p>
</div>
<p><strong>NixOS</strong></p>
<p>Build an air-gapped NixOS LiveCD image:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="go">ref=$(git ls-remote https://github.com/drduh/Yubikey-Guide refs/heads/master | awk &#39;{print $1}&#39;)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="go">nix build --experimental-features &quot;nix-command flakes&quot; \</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="go">  github:drduh/YubiKey-Guide/$ref#nixosConfigurations.yubikeyLive.x86_64-linux.config.system.build.isoImage</span>
</code></pre></div>
<p>If you have this repository checked out:</p>
<p>Recommended, but optional: update <code>nixpkgs</code> and <code>drduh/config</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="go">nix flake update --commit-lock-file</span>
</code></pre></div>
<p>Build the image:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="go">nix build --experimental-features &quot;nix-command flakes&quot; .#nixosConfigurations.yubikeyLive.x86_64-linux.config.system.build.isoImage</span>
</code></pre></div>
<p>Copy it to a USB drive:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="go">sudo cp -v result/iso/yubikeyLive.iso /dev/sdc ; sync</span>
</code></pre></div>
<p>Skip steps to create a temporary working directory and a hardened configuration, as they are already part of the image.</p>
<p>If you want to test your build before copying it into a USB stick, you can try it out on your machine using a tool like QEMU.
Please keep in mind that a virtualized environment does not provide the same amount of security as an ephemeral system (see <em>Prepare environment</em> above).
Here is an example QEMU invocation after placing <code>yubikeyLive</code> in <code>result/iso</code> using the above <code>nix build</code> command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="gp"># </span>Launch<span class="w"> </span>with<span class="w"> </span>4G<span class="w"> </span>memory,<span class="w"> </span><span class="m">2</span><span class="w"> </span>CPUs<span class="w"> </span>and<span class="w"> </span>KVM<span class="w"> </span>enabled
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="go">qemu-system-x86_64 \</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="go">    -enable-kvm \</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="go">    -m 4G \</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="go">    -smp 2 \</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="go">    -drive readonly=on,media=cdrom,format=raw,file=result/iso/yubikeyLive.iso</span>
</code></pre></div>
<p><strong>Arch</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="go">sudo pacman -Syu gnupg pcsclite ccid yubikey-personalization</span>
</code></pre></div>
<p><strong>RHEL7</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="go">sudo yum install -y gnupg2 pinentry-curses pcsc-lite pcsc-lite-libs gnupg2-smime</span>
</code></pre></div>
<p><strong>Fedora</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="go">sudo dnf install wget</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="go">wget https://github.com/rpmsphere/noarch/raw/master/r/rpmsphere-release-38-1.noarch.rpm</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="go">sudo rpm -Uvh rpmsphere-release*rpm</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="go">sudo dnf install \</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="go">  gnupg2 dirmngr cryptsetup gnupg2-smime \</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="go">  pcsc-tools opensc pcsc-lite secure-delete \</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="go">  pgp-tools yubikey-personalization-gui</span>
</code></pre></div>
<h2 id="prepare-gnupg">Prepare GnuPG<a class="headerlink" href="#prepare-gnupg" title="Permanent link">⚓︎</a></h2>
<p>Create a temporary directory which will be cleared on <a href="https://en.wikipedia.org/wiki/Tmpfs">reboot</a> and set it as the GnuPG directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="go">export GNUPGHOME=$(mktemp -d -t gnupg-$(date +%Y-%m-%d)-XXXXXXXXXX)</span>
</code></pre></div>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">⚓︎</a></h3>
<p>Import or create a <a href="https://github.com/drduh/config/blob/master/gpg.conf">hardened configuration</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="go">cd $GNUPGHOME</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="go">wget https://raw.githubusercontent.com/drduh/config/master/gpg.conf</span>
</code></pre></div>
<p>The options will look similar to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="gp">$ </span>grep<span class="w"> </span>-ve<span class="w"> </span><span class="s2">&quot;^#&quot;</span><span class="w"> </span><span class="nv">$GNUPGHOME</span>/gpg.conf
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="go">personal-cipher-preferences AES256 AES192 AES</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="go">personal-digest-preferences SHA512 SHA384 SHA256</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="go">personal-compress-preferences ZLIB BZIP2 ZIP Uncompressed</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="go">default-preference-list SHA512 SHA384 SHA256 AES256 AES192 AES ZLIB BZIP2 ZIP Uncompressed</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="go">cert-digest-algo SHA512</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="go">s2k-digest-algo SHA512</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="go">s2k-cipher-algo AES256</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="go">charset utf-8</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="go">no-comments</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="go">no-emit-version</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="go">no-greeting</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="go">keyid-format 0xlong</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="go">list-options show-uid-validity</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="go">verify-options show-uid-validity</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="go">with-fingerprint</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="go">require-cross-certification</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="go">no-symkey-cache</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="go">armor</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="go">use-agent</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="go">throw-keyids</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Networking can be disabled for the remainder of the setup.</p>
</div>
<h3 id="identity">Identity<a class="headerlink" href="#identity" title="Permanent link">⚓︎</a></h3>
<p>When creating an identity with GnuPG, the default options ask for a "Real name", "Email address" and optional "Comment".</p>
<p>Depending on how you plan to use GnuPG, set these values respectively:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="go">export IDENTITY=&quot;YubiKey User &lt;yubikey@example&gt;&quot;</span>
</code></pre></div>
<p>Or use any attribute which will uniquely identity the key (this may be incompatible with certain use cases):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="go">export IDENTITY=&quot;My Cool YubiKey - 2024&quot;</span>
</code></pre></div>
<h3 id="key">Key<a class="headerlink" href="#key" title="Permanent link">⚓︎</a></h3>
<p>Select the desired algorithm and key size. This guide recommends 4096-bit RSA.</p>
<p>Set the value:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="go">export KEY_TYPE=rsa4096</span>
</code></pre></div>
<h3 id="expiration">Expiration<a class="headerlink" href="#expiration" title="Permanent link">⚓︎</a></h3>
<p>Determine the desired Subkey validity duration.</p>
<p>Setting a Subkey expiry forces identity and credential lifecycle management. However, setting an expiry on the Certify key is pointless, because it can just be used to extend itself. <a href="https://security.stackexchange.com/questions/14718/does-openpgp-key-expiration-add-to-security/79386#79386">Revocation certificates</a> should instead be used to revoke an identity.</p>
<p>This guide recommends a two year expiration for Subkeys to balance security and usability, however longer durations are possible to reduce maintenance frequency.</p>
<p>When Subkeys expire, they may still be used to decrypt with GnuPG and authenticate with SSH, however they can <strong>not</strong> be used to encrypt nor sign new messages.</p>
<p>Subkeys must be renewed or rotated using the Certify key - see <a href="#updating-keys">Updating keys</a>.</p>
<p>Set the expiration date to two years:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="go">export EXPIRATION=2y</span>
</code></pre></div>
<p>Or set the expiration date to a specific date to schedule maintenance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="go">export EXPIRATION=2026-05-01</span>
</code></pre></div>
<h3 id="passphrase">Passphrase<a class="headerlink" href="#passphrase" title="Permanent link">⚓︎</a></h3>
<p>Generate a passphrase for the Certify key. It will be used infrequently to manage Subkeys and should be very strong. The passphrase is recommended to consist of only uppercase letters and numbers for improved readability. <a href="https://secure.research.vt.edu/diceware">Diceware</a> is another method for creating memorable passphrases.</p>
<p>The following commands will generate a strong passphrase and avoid ambiguous characters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="go">export CERTIFY_PASS=$(LC_ALL=C tr -dc &#39;A-Z1-9&#39; &lt; /dev/urandom | \</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="go">  tr -d &quot;1IOS5U&quot; | fold -w 30 | sed &quot;-es/./ /&quot;{1..26..5} | \</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="go">  cut -c2- | tr &quot; &quot; &quot;-&quot; | head -1) ; printf &quot;\n$CERTIFY_PASS\n\n&quot;</span>
</code></pre></div>
<p>Write the passphrase in a secure location, ideally separate from the portable storage device used for key material, or memorize it.</p>
<p>This repository includes a <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.html"><code>passphrase.html</code></a> template to help with credential transcription. Save the raw file, open it with a browser and print. Use a pen or permanent marker to select a letter or number on each row for each character in the passphrase. <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.csv"><code>passphrase.csv</code></a> can also be printed without a browser:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="go">lp -d Printer-Name passphrase.csv</span>
</code></pre></div>
<h2 id="create-certify-key">Create Certify key<a class="headerlink" href="#create-certify-key" title="Permanent link">⚓︎</a></h2>
<p>The primary key to generate is the Certify key, which is responsible for issuing Subkeys for encryption, signature and authentication operations.</p>
<p>The Certify key should be kept offline at all times and only accessed from a dedicated and secure environment to issue or revoke Subkeys.</p>
<p>Do not set an expiration date on the Certify key.</p>
<p>Generate the Certify key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="go">echo &quot;$CERTIFY_PASS&quot; | gpg --batch --passphrase-fd 0 \</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="go">    --quick-generate-key &quot;$IDENTITY&quot; &quot;$KEY_TYPE&quot; cert never</span>
</code></pre></div>
<p>Set and view the Certify key identifier and fingerprint for use later:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="go">export KEYID=$(gpg -k --with-colons &quot;$IDENTITY&quot; | awk -F: &#39;/^pub:/ { print $5; exit }&#39;)</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="go">export KEYFP=$(gpg -k --with-colons &quot;$IDENTITY&quot; | awk -F: &#39;/^fpr:/ { print $10; exit }&#39;)</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="go">printf &quot;\nKey ID: %40s\nKey FP: %40s\n\n&quot; &quot;$KEYID&quot; &quot;$KEYFP&quot;</span>
</code></pre></div>
<h2 id="add-additional-uids-optional">Add additional uids (optional)<a class="headerlink" href="#add-additional-uids-optional" title="Permanent link">⚓︎</a></h2>
<h3 id="rationale">Rationale<a class="headerlink" href="#rationale" title="Permanent link">⚓︎</a></h3>
<p>This is an optional step if you have a use case which requires <a href="https://github.com/drduh/YubiKey-Guide/issues/445">additional identities</a>. Some non-exhaustive example use cases are:</p>
<ul>
<li>different email addresses for different languages</li>
<li>different email addresses for professional versus personal but please see alternative reason below for not tying these addresses together</li>
<li>anonymized email addresses for different git providers</li>
</ul>
<p>An alternative would be to have distinct keys but you would then require multiple YubiKeys, as each can only hold a single key for each type (signing, encryption, authentication). Nevertheless, there can be good reasons to have multiple YubiKeys:</p>
<ul>
<li>if you have different email addresses for professional versus personal use cases, having distinct keys allow you to disassociate the identities</li>
<li>if you are also using the YubiKey as a U2F or FIDO2 device, having multiple YubiKeys is generally recommended as a backup measure</li>
</ul>
<h3 id="steps">Steps<a class="headerlink" href="#steps" title="Permanent link">⚓︎</a></h3>
<p>Define an array containing additional uids. As this is bash syntax, each array element should be surrounded by quotes and each element should be separated by a space:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="go">declare -a additional_uids</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="go">additional_uids=(&quot;Super Cool YubiKey 2024&quot; &quot;uid 1 &lt;uid1@example.org&gt;&quot;)</span>
</code></pre></div>
<p>Add the additional uids to the key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="go">for uid in &quot;${additional_uids[@]}&quot; ; do \</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="go">    echo &quot;$CERTIFY_PASS&quot; | gpg --batch --passphrase-fd 0 --pinentry-mode=loopback --quick-add-uid &quot;$KEYFP&quot; &quot;$uid&quot;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="go">done</span>
</code></pre></div>
<p>Adjust the trust of the additional uids to be ultimate:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --edit-key &quot;$KEYID&quot; &lt;&lt;EOF</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="go">uid *</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="go">trust</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="go">5</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="go">y</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="go">save</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="go">EOF</span>
</code></pre></div>
<h2 id="create-subkeys">Create Subkeys<a class="headerlink" href="#create-subkeys" title="Permanent link">⚓︎</a></h2>
<p>Use the following command to generate Signature, Encryption and Authentication Subkeys using the previously configured key type, passphrase and expiration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="go">for SUBKEY in sign encrypt auth ; do \</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="go">  echo &quot;$CERTIFY_PASS&quot; | gpg --batch --pinentry-mode=loopback --passphrase-fd 0 \</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="go">      --quick-add-key &quot;$KEYFP&quot; &quot;$KEY_TYPE&quot; &quot;$SUBKEY&quot; &quot;$EXPIRATION&quot;</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="go">done</span>
</code></pre></div>
<h2 id="verify-keys">Verify keys<a class="headerlink" href="#verify-keys" title="Permanent link">⚓︎</a></h2>
<p>List available secret keys:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="go">gpg -K</span>
</code></pre></div>
<p>The output will display <strong>[C]ertify, [S]ignature, [E]ncryption and [A]uthentication</strong> keys:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="go">sec   rsa4096/0xF0F2CFEB04341FB5 2024-01-01 [C]</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="go">      Key fingerprint = 4E2C 1FA3 372C BA96 A06A  C34A F0F2 CFEB 0434 1FB5</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="go">uid                   [ultimate] YubiKey User &lt;yubikey@example&gt;</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="go">ssb   rsa4096/0xB3CD10E502E19637 2024-01-01 [S] [expires: 2026-05-01]</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="go">ssb   rsa4096/0x30CBE8C4B085B9F7 2024-01-01 [E] [expires: 2026-05-01]</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="go">ssb   rsa4096/0xAD9E24E1B8CB9600 2024-01-01 [A] [expires: 2026-05-01]</span>
</code></pre></div>
<h2 id="backup-keys">Backup keys<a class="headerlink" href="#backup-keys" title="Permanent link">⚓︎</a></h2>
<p>Save a copy of the Certify key, Subkeys and public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="go">echo &quot;$CERTIFY_PASS&quot; | gpg --output $GNUPGHOME/$KEYID-Certify.key \</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="go">    --batch --pinentry-mode=loopback --passphrase-fd 0 \</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="go">    --armor --export-secret-keys $KEYID</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="go">echo &quot;$CERTIFY_PASS&quot; | gpg --output $GNUPGHOME/$KEYID-Subkeys.key \</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="go">    --batch --pinentry-mode=loopback --passphrase-fd 0 \</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="go">    --armor --export-secret-subkeys $KEYID</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="go">gpg --output $GNUPGHOME/$KEYID-$(date +%F).asc \</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="go">    --armor --export $KEYID</span>
</code></pre></div>
<p>Create an <strong>encrypted</strong> backup on portable storage to be kept offline in a secure and durable location.</p>
<p>The following process is recommended to be repeated several times on multiple portable storage devices, as they are likely to fail over time. As an additional backup measure, <a href="https://www.jabberwocky.com/software/paperkey/">Paperkey</a> can be used to make a physical copy of key materials for improved durability.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a href="https://en.wikipedia.org/wiki/Ext2">ext2</a> filesystem without encryption can be mounted on Linux and OpenBSD. Use <a href="https://en.wikipedia.org/wiki/Fat32">FAT32</a> or <a href="https://en.wikipedia.org/wiki/Ntfs">NTFS</a> filesystem for macOS and Windows compatibility instead.</p>
</div>
<p><strong>Linux</strong></p>
<p>Attach a portable storage device and check its label, in this case <code>/dev/sdc</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="go">usb-storage 3-2:1.0: USB Mass Storage device detected</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="go">sd 2:0:0:0: [sdc] Attached SCSI removable disk</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="gp">$ </span>sudo<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>/dev/sdc
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="go">Disk /dev/sdc: 14.9 GiB, 15931539456 bytes, 31116288 sectors</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Confirm the destination (<code>of</code>) before issuing the following command - it is destructive! This guide uses <code>/dev/sdc</code> throughout, but this value may be different on your system.</p>
</div>
<p>Zero the header to prepare for encryption:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="go">sudo dd if=/dev/zero of=/dev/sdc bs=4M count=1</span>
</code></pre></div>
<p>Remove and re-connect the storage device.</p>
<p>Erase and create a new partition table:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="go">sudo fdisk /dev/sdc &lt;&lt;EOF</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="go">g</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="go">w</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="go">EOF</span>
</code></pre></div>
<p>Create a small (at least 20 Mb is recommended to account for the LUKS header size) partition for storing secret materials:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="go">sudo fdisk /dev/sdc &lt;&lt;EOF</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="go">n</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="go">+20M</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="go">w</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="go">EOF</span>
</code></pre></div>
<p>Use <a href="https://dys2p.com/en/2023-05-luks-security.html">LUKS</a> to encrypt the new partition.</p>
<p>Generate another unique <a href="#passphrase">Passphrase</a> (ideally different from the one used for the Certify key) to protect the encrypted volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="go">export LUKS_PASS=$(LC_ALL=C tr -dc &#39;A-Z1-9&#39; &lt; /dev/urandom | \</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="go">  tr -d &quot;1IOS5U&quot; | fold -w 30 | sed &quot;-es/./ /&quot;{1..26..5} | \</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="go">  cut -c2- | tr &quot; &quot; &quot;-&quot; | head -1) ; printf &quot;\n$LUKS_PASS\n\n&quot;</span>
</code></pre></div>
<p>This passphrase will also be used infrequently to access the Certify key and should be very strong.</p>
<p>Write the passphrase down or memorize it.</p>
<p>Format the partition:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="go">echo $LUKS_PASS | sudo cryptsetup -q luksFormat /dev/sdc1</span>
</code></pre></div>
<p>Mount the partition:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="go">echo $LUKS_PASS | sudo cryptsetup -q luksOpen /dev/sdc1 gnupg-secrets</span>
</code></pre></div>
<p>Create an ext2 filesystem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="go">sudo mkfs.ext2 /dev/mapper/gnupg-secrets -L gnupg-$(date +%F)</span>
</code></pre></div>
<p>Mount the filesystem and copy the temporary GnuPG working directory with key materials:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="go">sudo mkdir /mnt/encrypted-storage</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="go">sudo mount /dev/mapper/gnupg-secrets /mnt/encrypted-storage</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="go">sudo cp -av $GNUPGHOME /mnt/encrypted-storage/</span>
</code></pre></div>
<p>Unmount and close the encrypted volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="go">sudo umount /mnt/encrypted-storage</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="go">sudo cryptsetup luksClose gnupg-secrets</span>
</code></pre></div>
<p>Repeat the process for any additional storage devices (at least two are recommended).</p>
<p><strong>OpenBSD</strong></p>
<p>Attach a USB disk and determine its label:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="gp">$ </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>sd.<span class="se">\ </span>at
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="go">sd2 at scsibus5 targ 1 lun 0: &lt;TS-RDF5, SD Transcend, TS37&gt; SCSI4 0/direct removable serial.00000000000000000000</span>
</code></pre></div>
<p>Print the existing partitions to make sure it's the right device:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="go">doas disklabel -h sd2</span>
</code></pre></div>
<p>Initialize the disk by creating an <code>a</code> partition with FS type <code>RAID</code> and size of 25 Megabytes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="gp">$ </span>doas<span class="w"> </span>fdisk<span class="w"> </span>-giy<span class="w"> </span>sd2
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="go">Writing MBR at offset 0.</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="go">Writing GPT.</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="gp">$ </span>doas<span class="w"> </span>disklabel<span class="w"> </span>-E<span class="w"> </span>sd2
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="go">Label editor (enter &#39;?&#39; for help at any prompt)</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="go">sd2&gt; a a</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="go">offset: [64]</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="go">size: [31101776] 25M</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="go">FS type: [4.2BSD] RAID</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="go">sd2*&gt; w</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="go">sd2&gt; q</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="go">No label changes</span>
</code></pre></div>
<p>Encrypt with bioctl using a unique <a href="#passphrase">Passphrase</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="gp">$ </span>doas<span class="w"> </span>bioctl<span class="w"> </span>-c<span class="w"> </span>C<span class="w"> </span>-l<span class="w"> </span>sd2a<span class="w"> </span>softraid0
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="go">New passphrase:</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="go">Re-type passphrase:</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="go">softraid0: CRYPTO volume attached as sd3</span>
</code></pre></div>
<p>Create an <code>i</code> partition on the new crypto volume and the filesystem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="gp">$ </span>doas<span class="w"> </span>fdisk<span class="w"> </span>-giy<span class="w"> </span>sd3
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="go">Writing MBR at offset 0.</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="go">Writing GPT.</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="gp">$ </span>doas<span class="w"> </span>disklabel<span class="w"> </span>-E<span class="w"> </span>sd3
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="go">Label editor (enter &#39;?&#39; for help at any prompt)</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="go">sd3&gt; a i</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="go">offset: [64]</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="go">size: [16001]</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="go">FS type: [4.2BSD]</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="go">sd3*&gt; w</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="go">sd3&gt; q</span>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="go">No label changes.</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="gp">$ </span>doas<span class="w"> </span>newfs<span class="w"> </span>sd3i
</code></pre></div>
<p>Mount the filesystem and copy the temporary directory with the keyring:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="go">doas mkdir /mnt/encrypted-storage</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="go">doas mount /dev/sd3i /mnt/encrypted-storage</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="go">doas cp -av $GNUPGHOME /mnt/encrypted-storage</span>
</code></pre></div>
<p>Unmount and remove the encrypted volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="go">doas umount /mnt/encrypted-storage</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="go">doas bioctl -d sd3</span>
</code></pre></div>
<p>See <a href="https://www.openbsd.org/faq/faq14.html#softraidCrypto">OpenBSD FAQ#14</a> for more information.</p>
<h2 id="export-public-key">Export public key<a class="headerlink" href="#export-public-key" title="Permanent link">⚓︎</a></h2>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>Without the public key, it will <strong>not</strong> be possible to use GnuPG to decrypt nor sign messages. However, YubiKey can still be used for SSH authentication.</p>
</div>
<p>Connect another portable storage device or create a new partition on the existing one.</p>
<p><strong>Linux</strong></p>
<p>Using the same <code>/dev/sdc</code> device as in the previous step, create a small (at least 20 Mb is recommended) partition for storing materials:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="go">sudo fdisk /dev/sdc &lt;&lt;EOF</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="go">n</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="go">+20M</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="go">w</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="go">EOF</span>
</code></pre></div>
<p>Create a filesystem and export the public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="go">sudo mkfs.ext2 /dev/sdc2</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="go">sudo mkdir /mnt/public</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="go">sudo mount /dev/sdc2 /mnt/public</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="go">gpg --armor --export $KEYID | sudo tee /mnt/public/$KEYID-$(date +%F).asc</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="go">sudo chmod 0444 /mnt/public/*.asc</span>
</code></pre></div>
<p>Unmount and remove the storage device:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="go">sudo umount /mnt/public</span>
</code></pre></div>
<p><strong>OpenBSD</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="gp">$ </span>doas<span class="w"> </span>disklabel<span class="w"> </span>-E<span class="w"> </span>sd2
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="go">Label editor (enter &#39;?&#39; for help at any prompt)</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="go">sd2&gt; a b</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="go">offset: [32130]</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="go">size: [31069710] 25M</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="go">FS type: [swap] 4.2BSD</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="go">sd2*&gt; w</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="go">sd2&gt; q</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="go">No label changes.</span>
</code></pre></div>
<p>Create a filesystem and export the public key to it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="go">doas newfs sd2b</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="go">doas mkdir /mnt/public</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="go">doas mount /dev/sd2b /mnt/public</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="go">gpg --armor --export $KEYID | doas tee /mnt/public/$KEYID-$(date +%F).asc</span>
</code></pre></div>
<p>Unmount and remove the storage device:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="go">doas umount /mnt/public</span>
</code></pre></div>
<h2 id="configure-yubikey">Configure YubiKey<a class="headerlink" href="#configure-yubikey" title="Permanent link">⚓︎</a></h2>
<p>Connect YubiKey and confirm its status:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="go">gpg --card-status</span>
</code></pre></div>
<p>If the card is locked, <a href="#reset-yubikey">Reset</a> it.</p>
<h3 id="change-pin">Change PIN<a class="headerlink" href="#change-pin" title="Permanent link">⚓︎</a></h3>
<p>YubiKey's <a href="https://developers.yubico.com/PGP/">PGP</a> interface has its own PINs separate from other modules such as <a href="https://developers.yubico.com/PIV/Introduction/YubiKey_and_PIV.html">PIV</a>:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th>Capability</th>
</tr>
</thead>
<tbody>
<tr>
<td>User PIN</td>
<td><code>123456</code></td>
<td>cryptographic operations (decrypt, sign, authenticate)</td>
</tr>
<tr>
<td>Admin PIN</td>
<td><code>12345678</code></td>
<td>reset PIN, change Reset Code, add keys and owner information</td>
</tr>
<tr>
<td>Reset Code</td>
<td>None</td>
<td>reset PIN (<a href="https://forum.yubico.com/viewtopicd01c.html?p=9055#p9055">more information</a>)</td>
</tr>
</tbody>
</table>
<p>Determine the desired PIN values. They can be shorter than the Certify key passphrase due to limited brute-forcing opportunities; the User PIN should be convenient enough to remember for every-day use.</p>
<p>The <em>User PIN</em> must be at least 6 characters and the <em>Admin PIN</em> must be at least 8 characters. A maximum of 127 ASCII characters are allowed. See <a href="https://www.gnupg.org/howtos/card-howto/en/ch03s02.html">GnuPG - Managing PINs</a> for more information.</p>
<p>Set PINs manually or generate them, for example a 6 digit User PIN and 8 digit Admin PIN:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="go">export ADMIN_PIN=$(LC_ALL=C tr -dc &#39;0-9&#39; &lt; /dev/urandom | fold -w8 | head -1)</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="go">export USER_PIN=$(LC_ALL=C tr -dc &#39;0-9&#39; &lt; /dev/urandom | fold -w6 | head -1)</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="go">printf &quot;\nAdmin PIN: %12s\nUser PIN: %13s\n\n&quot; &quot;$ADMIN_PIN&quot; &quot;$USER_PIN&quot;</span>
</code></pre></div>
<p>Change the Admin PIN:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --change-pin &lt;&lt;EOF</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="go">3</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="go">12345678</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="gp">$</span>ADMIN_PIN
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="gp">$</span>ADMIN_PIN
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="go">q</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="go">EOF</span>
</code></pre></div>
<p>Change the User PIN:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --change-pin &lt;&lt;EOF</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="go">1</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="go">123456</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="gp">$</span>USER_PIN
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="gp">$</span>USER_PIN
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="go">q</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="go">EOF</span>
</code></pre></div>
<p>Remove and re-insert YubiKey.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Three incorrect <em>User PIN</em> entries will cause it to become blocked and must be unblocked with either the <em>Admin PIN</em> or <em>Reset Code</em>. </p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Three incorrect <em>Admin PIN</em> or <em>Reset Code</em> entries will destroy data on YubiKey.</p>
</div>
<p>The number of <a href="https://docs.yubico.com/software/yubikey/tools/ykman/OpenPGP_Commands.html#ykman-openpgp-access-set-retries-options-pin-retries-reset-code-retries-admin-pin-retries">retry attempts</a> can be changed, for example to 5 attempts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="go">ykman openpgp access set-retries 5 5 5 -f -a $ADMIN_PIN</span>
</code></pre></div>
<h3 id="set-attributes">Set attributes<a class="headerlink" href="#set-attributes" title="Permanent link">⚓︎</a></h3>
<p>Set the <a href="https://gnupg.org/howtos/card-howto/en/smartcard-howto-single.html">smart card attributes</a> with <code>gpg --edit-card</code> and <code>admin</code> mode - use <code>help</code> to see available options.</p>
<p>Or use predetermined values:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --edit-card &lt;&lt;EOF</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="go">admin</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="go">login</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="gp">$</span>IDENTITY
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="gp">$</span>ADMIN_PIN
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="go">quit</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="go">EOF</span>
</code></pre></div>
<p>Run <code>gpg --card-status</code> to verify results (<em>Login data</em> field).</p>
<h2 id="transfer-subkeys">Transfer Subkeys<a class="headerlink" href="#transfer-subkeys" title="Permanent link">⚓︎</a></h2>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>Transferring keys to YubiKey is a one-way operation which converts the on-disk key into a stub making it no longer usable to transfer to subsequent YubiKeys. Ensure a backup was made before proceeding.</p>
</div>
<p>The Certify key passphrase and Admin PIN are required to transfer keys.</p>
<h3 id="signature-key">Signature key<a class="headerlink" href="#signature-key" title="Permanent link">⚓︎</a></h3>
<p>Transfer the first key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --edit-key $KEYID &lt;&lt;EOF</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="go">key 1</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="go">keytocard</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="go">1</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="gp">$</span>CERTIFY_PASS
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="gp">$</span>ADMIN_PIN
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="go">save</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="go">EOF</span>
</code></pre></div>
<h3 id="encryption-key">Encryption key<a class="headerlink" href="#encryption-key" title="Permanent link">⚓︎</a></h3>
<p>Repeat the process for the second key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --edit-key $KEYID &lt;&lt;EOF</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="go">key 2</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="go">keytocard</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="go">2</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="gp">$</span>CERTIFY_PASS
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="gp">$</span>ADMIN_PIN
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="go">save</span>
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="go">EOF</span>
</code></pre></div>
<h3 id="authentication-key">Authentication key<a class="headerlink" href="#authentication-key" title="Permanent link">⚓︎</a></h3>
<p>Repeat the process for the third key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --edit-key $KEYID &lt;&lt;EOF</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="go">key 3</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="go">keytocard</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="go">3</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="gp">$</span>CERTIFY_PASS
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="gp">$</span>ADMIN_PIN
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="go">save</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="go">EOF</span>
</code></pre></div>
<h2 id="verify-transfer">Verify transfer<a class="headerlink" href="#verify-transfer" title="Permanent link">⚓︎</a></h2>
<p>Verify Subkeys have been moved to YubiKey with <code>gpg -K</code> and look for <code>ssb&gt;</code>, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="go">sec   rsa4096/0xF0F2CFEB04341FB5 2024-01-01 [C]</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="go">      Key fingerprint = 4E2C 1FA3 372C BA96 A06A  C34A F0F2 CFEB 0434 1FB5</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="go">uid                   [ultimate] YubiKey User &lt;yubikey@example&gt;</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="go">ssb&gt;  rsa4096/0xB3CD10E502E19637 2024-01-01 [S] [expires: 2026-05-01]</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="go">ssb&gt;  rsa4096/0x30CBE8C4B085B9F7 2024-01-01 [E] [expires: 2026-05-01]</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="go">ssb&gt;  rsa4096/0xAD9E24E1B8CB9600 2024-01-01 [A] [expires: 2026-05-01]</span>
</code></pre></div>
<p>The <code>&gt;</code> after a tag indicates the key is stored on a smart card.</p>
<h2 id="finish-setup">Finish setup<a class="headerlink" href="#finish-setup" title="Permanent link">⚓︎</a></h2>
<p>Verify you have done the following:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Memorized or wrote down the Certify key (identity) passphrase to a secure and durable location</li>
<li><code>echo $CERTIFY_PASS</code> to see it again; <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.html"><code>passphrase.html</code></a> or <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.csv"><code>passphrase.csv</code></a> to transcribe it</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Memorized or wrote down passphrase to encrypted volume on portable storage</li>
<li><code>echo $LUKS_PASS</code> to see it again; <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.html"><code>passphrase.html</code></a> or <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.csv"><code>passphrase.csv</code></a> to transcribe it</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Saved the Certify key and Subkeys to encrypted portable storage, to be kept offline</li>
<li>At least two backups are recommended, stored at separate locations</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Exported a copy of the public key where is can be easily accessed later</li>
<li>Separate device or non-encrypted partition was used</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Memorized or wrote down the User PIN and Admin PIN, which are unique and changed from default values</li>
<li><code>echo $USER_PIN $ADMIN_PIN</code> to see them again; <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.html"><code>passphrase.html</code></a> or <a href="https://raw.githubusercontent.com/drduh/YubiKey-Guide/master/passphrase.csv"><code>passphrase.csv</code></a> to transcribe them</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Moved Encryption, Signature and Authentication Subkeys to YubiKey</li>
<li><code>gpg -K</code> shows <code>ssb&gt;</code> for each of the 3 Subkeys</li>
</ul>
<p>Reboot to clear the ephemeral environment and complete setup.</p>
<h2 id="using-yubikey">Using YubiKey<a class="headerlink" href="#using-yubikey" title="Permanent link">⚓︎</a></h2>
<p>Initialize GnuPG:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="go">gpg -k</span>
</code></pre></div>
<p>Import or create a <a href="https://github.com/drduh/config/blob/master/gpg.conf">hardened configuration</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="go">cd ~/.gnupg</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="go">wget https://raw.githubusercontent.com/drduh/config/master/gpg.conf</span>
</code></pre></div>
<p>Set the following option. This avoids the problem where GnuPG will repeatedly prompt for the insertion of an already-inserted YubiKey:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="go">touch scdaemon.conf</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="go">echo &quot;disable-ccid&quot; &gt;&gt;scdaemon.conf</span>
</code></pre></div>
<p>Install the required packages:</p>
<p><strong>Debian/Ubuntu</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="go">sudo apt update</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="go">sudo apt install -y gnupg gnupg-agent scdaemon pcscd</span>
</code></pre></div>
<p><strong>OpenBSD</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="go">doas pkg_add gnupg pcsc-tools</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="go">doas rcctl enable pcscd</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="go">doas reboot</span>
</code></pre></div>
<p>Mount the non-encrypted volume with the public key:</p>
<p><strong>Debian/Ubuntu</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="go">sudo mkdir /mnt/public</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="go">sudo mount /dev/sdc2 /mnt/public</span>
</code></pre></div>
<p><strong>OpenBSD</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="go">doas mkdir /mnt/public</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="go">doas mount /dev/sd3i /mnt/public</span>
</code></pre></div>
<p>Import the public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="go">gpg --import /mnt/public/*.asc</span>
</code></pre></div>
<p>Or download the public key from a keyserver:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="go">gpg --recv $KEYID</span>
</code></pre></div>
<p>Or with the URL on YubiKey, retrieve the public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="go">gpg/card&gt; fetch</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="go">gpg/card&gt; quit</span>
</code></pre></div>
<p>Determine the key ID:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="go">gpg -k</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="go">export KEYID=0xF0F2CFEB04341FB5</span>
</code></pre></div>
<p>Assign ultimate trust by typing <code>trust</code> and selecting option <code>5</code> then <code>quit</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --edit-key $KEYID &lt;&lt;EOF</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="go">trust</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="go">5</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="go">y</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="go">save</span>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="go">EOF</span>
</code></pre></div>
<p>Remove and re-insert YubiKey.</p>
<p>Verify the status with <code>gpg --card-status</code> which will list the available Subkeys:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="go">Reader ...........: Yubico YubiKey OTP FIDO CCID 00 00</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="go">Application ID ...: D2760001240102010006055532110000</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="go">Application type .: OpenPGP</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="go">Version ..........: 3.4</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="go">Manufacturer .....: Yubico</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="go">Serial number ....: 05553211</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="go">Name of cardholder: YubiKey User</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="go">Language prefs ...: en</span>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="go">Salutation .......:</span>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="go">URL of public key : [not set]</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="go">Login data .......: yubikey@example</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="go">Signature PIN ....: not forced</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="go">Key attributes ...: rsa4096 rsa4096 rsa4096</span>
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="go">Max. PIN lengths .: 127 127 127</span>
<a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="go">PIN retry counter : 3 3 3</span>
<a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a><span class="go">Signature counter : 0</span>
<a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="go">KDF setting ......: on</span>
<a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="go">Signature key ....: CF5A 305B 808B 7A0F 230D  A064 B3CD 10E5 02E1 9637</span>
<a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="go">      created ....: 2024-01-01 12:00:00</span>
<a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a><span class="go">Encryption key....: A5FA A005 5BED 4DC9 889D  38BC 30CB E8C4 B085 B9F7</span>
<a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="go">      created ....: 2024-01-01 12:00:00</span>
<a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="go">Authentication key: 570E 1355 6D01 4C04 8B6D  E2A3 AD9E 24E1 B8CB 9600</span>
<a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a><span class="go">      created ....: 2024-01-01 12:00:00</span>
<a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a><span class="go">General key info..: sub  rsa4096/0xB3CD10E502E19637 2024-01-01 YubiKey User &lt;yubikey@example&gt;</span>
<a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a><span class="go">sec#  rsa4096/0xF0F2CFEB04341FB5  created: 2024-01-01  expires: never</span>
<a id="__codelineno-84-26" name="__codelineno-84-26" href="#__codelineno-84-26"></a><span class="go">ssb&gt;  rsa4096/0xB3CD10E502E19637  created: 2024-01-01  expires: 2026-05-01</span>
<a id="__codelineno-84-27" name="__codelineno-84-27" href="#__codelineno-84-27"></a><span class="go">                                  card-no: 0006 05553211</span>
<a id="__codelineno-84-28" name="__codelineno-84-28" href="#__codelineno-84-28"></a><span class="go">ssb&gt;  rsa4096/0x30CBE8C4B085B9F7  created: 2024-01-01  expires: 2026-05-01</span>
<a id="__codelineno-84-29" name="__codelineno-84-29" href="#__codelineno-84-29"></a><span class="go">                                  card-no: 0006 05553211</span>
<a id="__codelineno-84-30" name="__codelineno-84-30" href="#__codelineno-84-30"></a><span class="go">ssb&gt;  rsa4096/0xAD9E24E1B8CB9600  created: 2024-01-01  expires: 2026-05-01</span>
<a id="__codelineno-84-31" name="__codelineno-84-31" href="#__codelineno-84-31"></a><span class="go">                                  card-no: 0006 05553211</span>
</code></pre></div>
<p><code>sec#</code> indicates the corresponding key is not available (the Certify key is offline).</p>
<p>YubiKey is now ready for use!</p>
<h3 id="encryption">Encryption<a class="headerlink" href="#encryption" title="Permanent link">⚓︎</a></h3>
<p>Encrypt a message to yourself (useful for storing credentials or protecting backups):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="go">echo &quot;\ntest message string&quot; | \</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="go">  gpg --encrypt --armor \</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="go">      --recipient $KEYID --output encrypted.txt</span>
</code></pre></div>
<p>Decrypt the message - a prompt for the User PIN will appear:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="go">gpg --decrypt --armor encrypted.txt</span>
</code></pre></div>
<p>To encrypt to multiple recipients/keys, set the preferred key ID last:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="go">echo &quot;test message string&quot; | \</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="go">  gpg --encrypt --armor \</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="go">      --recipient $KEYID_2 --recipient $KEYID_1 --recipient $KEYID \</span>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="go">      --output encrypted.txt</span>
</code></pre></div>
<p>Use a <a href="https://github.com/drduh/config/blob/master/zshrc">shell function</a> to make encrypting files easier:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="go">secret () {</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="go">  output=&quot;${1}&quot;.$(date +%s).enc</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="go">  gpg --encrypt --armor --output ${output} \</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="go">    -r $KEYID &quot;${1}&quot; &amp;&amp; echo &quot;${1} -&gt; ${output}&quot;</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="go">}</span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="go">reveal () {</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="go">  output=$(echo &quot;${1}&quot; | rev | cut -c16- | rev)</span>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="go">  gpg --decrypt --output ${output} &quot;${1}&quot; &amp;&amp; \</span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="go">    echo &quot;${1} -&gt; ${output}&quot;</span>
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="go">}</span>
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="gp">$ </span>secret<span class="w"> </span>document.pdf
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="go">document.pdf -&gt; document.pdf.1580000000.enc</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="gp">$ </span>reveal<span class="w"> </span>document.pdf.1580000000.enc
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="go">gpg: anonymous recipient; trying secret key 0xF0F2CFEB04341FB5 ...</span>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="go">gpg: okay, we are the anonymous recipient.</span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="go">gpg: encrypted with RSA key, ID 0x0000000000000000</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="go">document.pdf.1580000000.enc -&gt; document.pdf</span>
</code></pre></div>
<p><a href="https://github.com/drduh/Purse">drduh/Purse</a> is a password manager based on GnuPG and YubiKey to securely store and use credentials.</p>
<h3 id="signature">Signature<a class="headerlink" href="#signature" title="Permanent link">⚓︎</a></h3>
<p>Sign a message:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="go">echo &quot;test message string&quot; | gpg --armor --clearsign &gt; signed.txt</span>
</code></pre></div>
<p>Verify the signature:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="go">gpg --verify signed.txt</span>
</code></pre></div>
<p>The output will be similar to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="go">gpg: Signature made Mon 01 Jan 2024 12:00:00 PM UTC</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="go">gpg:                using RSA key CF5A305B808B7A0F230DA064B3CD10E502E19637</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="go">gpg: Good signature from &quot;YubiKey User &lt;yubikey@example&gt;&quot; [ultimate]</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="go">Primary key fingerprint: 4E2C 1FA3 372C BA96 A06A  C34A F0F2 CFEB 0434 1FB5</span>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="go">     Subkey fingerprint: CF5A 305B 808B 7A0F 230D  A064 B3CD 10E5 02E1 9637</span>
</code></pre></div>
<h3 id="configure-touch">Configure touch<a class="headerlink" href="#configure-touch" title="Permanent link">⚓︎</a></h3>
<p>By default, YubiKey will perform cryptographic operations without requiring any action from the user after the key is unlocked once with the PIN.</p>
<p>To require a touch for each key operation, use <a href="https://developers.yubico.com/yubikey-manager/">YubiKey Manager</a> and the Admin PIN to set key policy.</p>
<p>Encryption:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="go">ykman openpgp keys set-touch dec on</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Versions of YubiKey Manager before 5.1.0 use <code>enc</code> instead of <code>dec</code> for encryption:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="go">ykman openpgp keys set-touch enc on</span>
</code></pre></div>
<p>Even older versions of YubiKey Manager use <code>touch</code> instead of <code>set-touch</code></p>
<p>Signature:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="go">ykman openpgp keys set-touch sig on</span>
</code></pre></div>
<p>Authentication:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="go">ykman openpgp keys set-touch aut on</span>
</code></pre></div>
<p>To view and adjust policy options:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="go">ykman openpgp keys set-touch -h</span>
</code></pre></div>
</div>
<p><code>Cached</code> or <code>Cached-Fixed</code> may be desirable for YubiKey use with email clients.</p>
<p>YubiKey will blink when it is waiting for a touch. On Linux, <a href="https://github.com/maximbaz/yubikey-touch-detector">maximbaz/yubikey-touch-detector</a> can be used to indicate YubiKey is waiting for a touch.</p>
<h3 id="ssh">SSH<a class="headerlink" href="#ssh" title="Permanent link">⚓︎</a></h3>
<p>Import or create a <a href="https://github.com/drduh/config/blob/master/gpg-agent.conf">hardened configuration</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="go">cd ~/.gnupg</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="go">wget https://raw.githubusercontent.com/drduh/config/master/gpg-agent.conf</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>The <code>cache-ttl</code> options do <strong>not</strong> apply when using YubiKey as a smart card, because the PIN is <a href="https://dev.gnupg.org/T3362">cached by the smart card itself</a>. To clear the PIN from cache (equivalent to <code>default-cache-ttl</code> and <code>max-cache-ttl</code>), remove YubiKey, or set <code>forcesig</code> when editing the card to be prompted for the PIN each time.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Set <code>pinentry-program</code> to <code>/usr/bin/pinentry-gnome3</code> for a GUI-based prompt.</p>
</div>
<p><strong>macOS</strong></p>
<p>Install pinentry with <code>brew install pinentry-mac</code> then edit <code>gpg-agent.conf</code> to set the <code>pinentry-program</code> path to:</p>
<ul>
<li>Apple Silicon Macs: <code>/opt/homebrew/bin/pinentry-mac</code></li>
<li>Intel Macs: <code>/usr/local/bin/pinentry-mac</code></li>
<li>MacGPG Suite: <code>/usr/local/MacGPG2/libexec/pinentry-mac.app/Contents/MacOS/pinentry-mac</code></li>
</ul>
<p>Then run <code>gpgconf --kill gpg-agent</code> for the change to take effect.</p>
<p>To use graphical applications on macOS, <a href="https://jms1.net/yubikey/make-ssh-use-gpg-agent.md">additional setup is required</a>.</p>
<p>Create <code>$HOME/Library/LaunchAgents/gnupg.gpg-agent.plist</code> with the following contents:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-99-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-99-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-99-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-99-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-99-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-99-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-99-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-99-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-99-10">10</a></span>
<span class="normal"><a href="#__codelineno-99-11">11</a></span>
<span class="normal"><a href="#__codelineno-99-12">12</a></span>
<span class="normal"><a href="#__codelineno-99-13">13</a></span>
<span class="normal"><a href="#__codelineno-99-14">14</a></span>
<span class="normal"><a href="#__codelineno-99-15">15</a></span>
<span class="normal"><a href="#__codelineno-99-16">16</a></span>
<span class="normal"><a href="#__codelineno-99-17">17</a></span>
<span class="normal"><a href="#__codelineno-99-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot;</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="cp">  &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
<a id="__codelineno-99-4" name="__codelineno-99-4"></a><span class="nt">&lt;plist</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-99-5" name="__codelineno-99-5"></a><span class="w">    </span><span class="nt">&lt;dict&gt;</span>
<a id="__codelineno-99-6" name="__codelineno-99-6"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-99-7" name="__codelineno-99-7"></a><span class="w">        </span><span class="nt">&lt;string&gt;</span>gnupg.gpg-agent<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-99-8" name="__codelineno-99-8"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-99-9" name="__codelineno-99-9"></a><span class="w">        </span><span class="nt">&lt;true/&gt;</span>
<a id="__codelineno-99-10" name="__codelineno-99-10"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-99-11" name="__codelineno-99-11"></a><span class="w">        </span><span class="nt">&lt;false/&gt;</span>
<a id="__codelineno-99-12" name="__codelineno-99-12"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-99-13" name="__codelineno-99-13"></a><span class="w">        </span><span class="nt">&lt;array&gt;</span>
<a id="__codelineno-99-14" name="__codelineno-99-14"></a><span class="w">            </span><span class="nt">&lt;string&gt;</span>/usr/local/MacGPG2/bin/gpg-connect-agent<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-99-15" name="__codelineno-99-15"></a><span class="w">            </span><span class="nt">&lt;string&gt;</span>/bye<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-99-16" name="__codelineno-99-16"></a><span class="w">        </span><span class="nt">&lt;/array&gt;</span>
<a id="__codelineno-99-17" name="__codelineno-99-17"></a><span class="w">    </span><span class="nt">&lt;/dict&gt;</span>
<a id="__codelineno-99-18" name="__codelineno-99-18"></a><span class="nt">&lt;/plist&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Load it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="go">launchctl load $HOME/Library/LaunchAgents/gnupg.gpg-agent.plist</span>
</code></pre></div>
<p>Create <code>$HOME/Library/LaunchAgents/gnupg.gpg-agent-symlink.plist</code> with the following contens:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-101-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-101-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-101-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-101-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-101-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-101-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-101-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-101-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-101-10">10</a></span>
<span class="normal"><a href="#__codelineno-101-11">11</a></span>
<span class="normal"><a href="#__codelineno-101-12">12</a></span>
<span class="normal"><a href="#__codelineno-101-13">13</a></span>
<span class="normal"><a href="#__codelineno-101-14">14</a></span>
<span class="normal"><a href="#__codelineno-101-15">15</a></span>
<span class="normal"><a href="#__codelineno-101-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/ProperyList-1.0/dtd&quot;&gt;</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="nt">&lt;plist</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="w">    </span><span class="nt">&lt;dict&gt;</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a><span class="w">        </span><span class="nt">&lt;string&gt;</span>gnupg.gpg-agent-symlink<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a><span class="w">        </span><span class="nt">&lt;array&gt;</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a><span class="w">            </span><span class="nt">&lt;string&gt;</span>/bin/sh<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a><span class="w">            </span><span class="nt">&lt;string&gt;</span>-c<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a><span class="w">            </span><span class="nt">&lt;string&gt;</span>/bin/ln<span class="w"> </span>-sf<span class="w"> </span>$HOME/.gnupg/S.gpg-agent.ssh<span class="w"> </span>$SSH_AUTH_SOCK<span class="nt">&lt;/string&gt;</span>
<a id="__codelineno-101-12" name="__codelineno-101-12"></a><span class="w">        </span><span class="nt">&lt;/array&gt;</span>
<a id="__codelineno-101-13" name="__codelineno-101-13"></a><span class="w">        </span><span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
<a id="__codelineno-101-14" name="__codelineno-101-14"></a><span class="w">        </span><span class="nt">&lt;true/&gt;</span>
<a id="__codelineno-101-15" name="__codelineno-101-15"></a><span class="w">    </span><span class="nt">&lt;/dict&gt;</span>
<a id="__codelineno-101-16" name="__codelineno-101-16"></a><span class="nt">&lt;/plist&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Load it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="go">launchctl load $HOME/Library/LaunchAgents/gnupg.gpg-agent-symlink.plist</span>
</code></pre></div>
<p>Reboot to activate changes.</p>
<p><strong>Windows</strong></p>
<p>Windows can already have some virtual smart card readers installed, like the one provided for Windows Hello. To verify YubiKey is the correct one used by scdaemon, add it to its configuration.</p>
<p>Find the YubiKey label using PowerShell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\</span><span class="n">WINDOWS</span><span class="p">\</span><span class="n">system32</span><span class="p">&gt;</span> <span class="nb">Get-PnpDevice</span> <span class="n">-Class</span> <span class="n">SoftwareDevice</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">FriendlyName</span> <span class="o">-like</span> <span class="s2">&quot;*YubiKey*&quot;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">FriendlyName</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="n">Yubico</span> <span class="n">YubiKey</span> <span class="n">OTP</span><span class="p">+</span><span class="n">FIDO</span><span class="p">+</span><span class="n">CCID</span> <span class="n">0</span>
</code></pre></div>
<p>See <a href="https://www.hanselman.com/blog/HowToSetupSignedGitCommitsWithAYubiKeyNEOAndGPGAndKeybaseOnWindows.aspx">How to setup Signed Git Commits with a YubiKey NEO and GPG and Keybase on Windows (2018)</a> for more information.</p>
<p>Edit <code>%APPDATA%/gnupg/scdaemon.conf</code> to add:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="go">reader-port &lt;device name, e.g. Yubico YubiKey OTP+FIDO+CCID 0&gt;</span>
</code></pre></div>
<p>Edit <code>%APPDATA%/gnupg/gpg-agent.conf</code> to add:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="go">enable-ssh-support</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="go">enable-putty-support</span>
</code></pre></div>
<p>Restart the agent:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="go">gpg-connect-agent killagent /bye</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="go">gpg-connect-agent /bye</span>
</code></pre></div>
<p>Verify YubiKey details:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="go">gpg --card-status</span>
</code></pre></div>
<p>Import the public key and set ultimate trust:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="go">gpg --import &lt;path to public key file&gt;</span>
</code></pre></div>
<p>Retrieve the public key id:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="go">gpg --list-public-keys</span>
</code></pre></div>
<p>Export the SSH public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="go">gpg --export-ssh-key &lt;public key id&gt;</span>
</code></pre></div>
<p>Copy the public SSH key to a file - it corresponds to the secret key on YubiKey and can be copied to SSH destination hosts.</p>
<p>Create a shortcut that points to <code>gpg-connect-agent /bye</code> and place it in the startup folder <code>shell:startup</code> to make sure the agent starts after reboot. Modify the shortcut properties so it starts in a "Minimized" window.</p>
<p>PuTTY can now be used for public-key SSH authentication. When the server asks for public-key verification, PuTTY will forward the request to GnuPG, which will prompt for a PIN to authorize the operation.</p>
<p><strong>WSL</strong></p>
<p>The goal is to configure SSH client inside WSL work together with the Windows agent, such as gpg-agent.exe.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GnuPG forwarding for cryptographic operations is not supported. See <a href="https://github.com/vuori/weasel-pageant">vuori/weasel-pageant</a> for more information.</p>
</div>
<p>One way to forward is just <code>ssh -A</code> (still need to eval weasel to setup local ssh-agent), and only relies on OpenSSH. In this track, <code>ForwardAgent</code> and <code>AllowAgentForwarding</code> in ssh/sshd config may be involved. However, when using ssh socket forwarding, do not enable <code>ForwardAgent</code> in ssh config. See <a href="#ssh-agent-forwarding">SSH Agent Forwarding</a> for more information. This requires Ubuntu 16.04 or newer for WSL and Kleopatra.</p>
<p>Download <a href="https://github.com/vuori/weasel-pageant">vuori/weasel-pageant</a>.</p>
<p>Add <code>eval $(/mnt/c/&lt;path of extraction&gt;/weasel-pageant -r -a /tmp/S.weasel-pageant)</code> to the shell rc file. Use a named socket here so it can be used in the <code>RemoteForward</code> directive of <code>~/.ssh/config</code>. Source it with <code>source ~/.bashrc</code>.</p>
<p>Display the SSH key with <code>$ ssh-add -l</code></p>
<p>Edit <code>~/.ssh/config</code> to add the following for each agent forwarding host:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="go">RemoteForward &lt;remote SSH socket path&gt; /tmp/S.weasel-pageant</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The remote SSH socket path can be found with <code>gpgconf --list-dirs agent-ssh-socket</code></p>
</div>
<p>Add the following to the shell rc file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="go">export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)</span>
</code></pre></div>
<p>Add the following to <code>/etc/ssh/sshd_config</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="go">StreamLocalBindUnlink yes</span>
</code></pre></div>
<p>Reload SSH daemon:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="go">sudo service sshd reload</span>
</code></pre></div>
<p>Remove YubiKey and reboot. Log back into Windows, open a WSL console and enter <code>ssh-add -l</code> - no output should appear.</p>
<p>Plug in YubiKey, enter the same command to display the ssh key.</p>
<p>Connect to the remote host and use <code>ssh-add -l</code> to confirm forwarding works.</p>
<p>Agent forwarding may be chained through multiple hosts. Follow the same <a href="#remote-host-configuration">protocol</a> to configure each host.</p>
<p>An alternate method is the <a href="https://github.com/dorssel/usbipd-win">usbipd-win</a> library. If you encounter issues with accessing the YubiKey in WSL after configuring usbipd-win, you may need to add custom polkit rules to ensure proper permissions for the pcscd service. Here's an example configuration using a scard group (the group logic is optional):</p>
<p>Create a new rule file at /etc/polkit-1/rules.d/99-pcscd.rules:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>polkit.addRule<span class="o">(</span><span class="k">function</span><span class="o">(</span>action,<span class="w"> </span>subject<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>action.id<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;org.debian.pcsc-lite.access_card&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="w">        </span>subject.isInGroup<span class="o">(</span><span class="s2">&quot;scard&quot;</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>polkit.Result.YES<span class="p">;</span>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="o">})</span><span class="p">;</span>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a>
<a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>polkit.addRule<span class="o">(</span><span class="k">function</span><span class="o">(</span>action,<span class="w"> </span>subject<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>action.id<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;org.debian.pcsc-lite.access_pcsc&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="w">        </span>subject.isInGroup<span class="o">(</span><span class="s2">&quot;scard&quot;</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>polkit.Result.YES<span class="p">;</span>
<a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="o">})</span><span class="p">;</span>
</code></pre></div>
<h4 id="replace-agents">Replace agents<a class="headerlink" href="#replace-agents" title="Permanent link">⚓︎</a></h4>
<p>To launch <code>gpg-agent</code> for use by SSH, use the <code>gpg-connect-agent /bye</code> or <code>gpgconf --launch gpg-agent</code> commands.</p>
<p>Add the following to the shell rc file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="go">export GPG_TTY=&quot;$(tty)&quot;</span>
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="go">export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)</span>
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="go">gpgconf --launch gpg-agent</span>
<a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="go">gpg-connect-agent updatestartuptty /bye &gt; /dev/null</span>
</code></pre></div>
<p>For fish, <code>config.fish</code> should look like this (consider putting them into the <code>is-interactive</code> block):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="k">set</span> -x GPG_TTY <span class="o">(</span>tty<span class="o">)</span>
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="k">set</span> -x SSH_AUTH_SOCK <span class="o">(</span>gpgconf --list-dirs agent-ssh-socket<span class="o">)</span>
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a>gpgconf --launch gpg-agent
</code></pre></div>
<p>When using <code>ForwardAgent</code> for ssh-agent forwarding, <code>SSH_AUTH_SOCK</code> only needs to be set on the <em>local</em> host, where YubiKey is connected. On the <em>remote</em> host, <code>ssh</code> will set <code>SSH_AUTH_SOCK</code> to something like <code>/tmp/ssh-mXzCzYT2Np/agent.7541</code> upon connection. Do <strong>not</strong> set <code>SSH_AUTH_SOCK</code> on the remote host - doing so will break <a href="#ssh-agent-forwarding">SSH Agent Forwarding</a>.</p>
<p>For <code>S.gpg-agent.ssh</code> (see <a href="#ssh-agent-forwarding">SSH Agent Forwarding</a> for more info), <code>SSH_AUTH_SOCK</code> should also be set on the <em>remote</em>. However, <code>GPG_TTY</code> should not be set on the <em>remote</em>, explanation specified in that section.</p>
<h4 id="copy-public-key">Copy public key<a class="headerlink" href="#copy-public-key" title="Permanent link">⚓︎</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is <strong>not</strong> necessary to import the GnuPG public key in order to use SSH only.</p>
</div>
<p>Copy and paste the output from <code>ssh-add</code> to the server's <code>authorized_keys</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="gp">$ </span>ssh-add<span class="w"> </span>-L
<a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="go">ssh-rsa AAAAB4NzaC1yc2EAAAADAQABAAACAz[...]zreOKM+HwpkHzcy9DQcVG2Nw== cardno:000605553211</span>
</code></pre></div>
<div class="admonition abstract">
<p class="admonition-title">Optional</p>
<p>Save the public key for identity file configuration. By default, SSH attempts to use all the identities available via the agent. It's often a good idea to manage exactly which keys SSH will use to connect to a server, for example to separate different roles or <a href="https://words.filippo.io/ssh-whoami-filippo-io/">to avoid being fingerprinted by untrusted ssh servers</a>. To do this you'll need to use the command line argument <code>-i [identity_file]</code> or the <code>IdentityFile</code> and <code>IdentitiesOnly</code> options in <code>.ssh/config</code>.</p>
</div>
<p>The argument provided to <code>IdentityFile</code> is traditionally the path to the <em>private</em> key file (for example <code>IdentityFile ~/.ssh/id_rsa</code>). For YubiKey, <code>IdentityFile</code> must point to the <em>public</em> key file, and <code>ssh</code> will select the appropriate private key from those available via ssh-agent. To prevent <code>ssh</code> from trying all keys in the agent, use <code>IdentitiesOnly yes</code> along with one or more <code>-i</code> or <code>IdentityFile</code> options for the target host.</p>
<p>To reiterate, with <code>IdentitiesOnly yes</code>, <code>ssh</code> will not enumerate public keys loaded into <code>ssh-agent</code> or <code>gpg-agent</code>. This means public-key authentication will not proceed unless explicitly named by <code>ssh -i [identity_file]</code> or in <code>.ssh/config</code> on a per-host basis.</p>
<p>In the case of YubiKey usage, to extract the public key from the ssh agent:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="go">ssh-add -L | grep &quot;cardno:000605553211&quot; &gt; ~/.ssh/id_rsa_yubikey.pub</span>
</code></pre></div>
<p>Then explicitly associate this YubiKey-stored key for used with a host, <code>github.com</code> for example, as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="gp">$ </span>cat<span class="w"> </span>&lt;&lt;<span class="w"> </span>EOF<span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/config
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="go">Host github.com</span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="go">    IdentitiesOnly yes</span>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="go">    IdentityFile ~/.ssh/id_rsa_yubikey.pub</span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="go">EOF</span>
</code></pre></div>
<p>Connect with public key authentication:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="gp">$ </span>ssh<span class="w"> </span>git@github.com<span class="w"> </span>-vvv
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="go">[...]</span>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="go">debug2: key: cardno:000605553211 (0x1234567890),</span>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="go">debug1: Authentications that can continue: publickey</span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="go">debug3: start over, passed a different list publickey</span>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="go">debug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password</span>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="go">debug3: authmethod_lookup publickey</span>
<a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="go">debug3: remaining preferred: keyboard-interactive,password</span>
<a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="go">debug3: authmethod_is_enabled publickey</span>
<a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="go">debug1: Next authentication method: publickey</span>
<a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="go">debug1: Offering RSA public key: cardno:000605553211</span>
<a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="go">debug3: send_pubkey_test</span>
<a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a><span class="go">debug2: we sent a publickey packet, wait for reply</span>
<a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="go">debug1: Server accepts key: pkalg ssh-rsa blen 535</span>
<a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a><span class="go">debug2: input_userauth_pk_ok: fp e5:de:a5:74:b1:3e:96:9b:85:46:e7:28:53:b4:82:c3</span>
<a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a><span class="go">debug3: sign_and_send_pubkey: RSA e5:de:a5:74:b1:3e:96:9b:85:46:e7:28:53:b4:82:c3</span>
<a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="go">debug1: Authentication succeeded (publickey).</span>
<a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a><span class="go">[...]</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To make multiple connections or securely transfer many files, use the <a href="https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Multiplexing">ControlMaster</a> ssh option.</p>
</div>
<h4 id="import-ssh-keys">Import SSH keys<a class="headerlink" href="#import-ssh-keys" title="Permanent link">⚓︎</a></h4>
<p>If there are existing SSH keys to make available via <code>gpg-agent</code>, they will need to be imported. Then, remove the original private keys. When importing the key, <code>gpg-agent</code> uses the key filename as the label - this makes it easier to follow where the key originated from. In this example, we're starting with just the YubiKey in place and importing <code>~/.ssh/id_rsa</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="gp">$ </span>ssh-add<span class="w"> </span>-l
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="go">4096 SHA256:... cardno:00060123456 (RSA)</span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a>
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="gp">$ </span>ssh-add<span class="w"> </span>~/.ssh/id_rsa<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>~/.ssh/id_rsa
</code></pre></div>
<p>When invoking <code>ssh-add</code>, a prompt for the SSH key passphrase will appear, then the <code>pinentry</code> program will prompt and confirm a new passphrase to encrypt the converted key within the GnuPG key store.</p>
<p>The migrated key will be listed in <code>ssh-add -l</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="gp">$ </span>ssh-add<span class="w"> </span>-l
<a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="go">4096 SHA256:... cardno:00060123456 (RSA)</span>
<a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="go">2048 SHA256:... /Users/username/.ssh/id_rsa (RSA)</span>
</code></pre></div>
<p>To show the keys with MD5 fingerprints, as used by <code>gpg-connect-agent</code>'s <code>KEYINFO</code> and <code>DELETE_KEY</code> commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="gp">$ </span>ssh-add<span class="w"> </span>-E<span class="w"> </span>md5<span class="w"> </span>-l
<a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="go">4096 MD5:... cardno:00060123456 (RSA)</span>
<a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="go">2048 MD5:... /Users/username/.ssh/id_rsa (RSA)</span>
</code></pre></div>
<p>When using the key <code>pinentry</code> will be invoked to request the key passphrase. The passphrase will be cached for up to 10 idle minutes between uses, up to a maximum of 2 hours.</p>
<h4 id="ssh-agent-forwarding">SSH agent forwarding<a class="headerlink" href="#ssh-agent-forwarding" title="Permanent link">⚓︎</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SSH Agent Forwarding can <a href="https://matrix.org/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-agent-forwarding-should-be-disabled">add additional risk</a> - proceed with caution!</p>
</div>
<p>There are two methods for ssh-agent forwarding, one is provided by OpenSSH and the other is provided by GnuPG.</p>
<p>The latter one may be more insecure as raw socket is just forwarded (not like <code>S.gpg-agent.extra</code> with only limited functionality; if <code>ForwardAgent</code> implemented by OpenSSH is just forwarding the raw socket, then they are insecure to the same degree). But for the latter one, one convenience is that one may forward once and use this agent everywhere in the remote. So again, proceed with caution!</p>
<p>For example, tmux does not have environment variables such as <code>$SSH_AUTH_SOCK</code> when connecting to remote hosts and attaching an existing session. For each shell, find the socket and <code>export SSH_AUTH_SOCK=/tmp/ssh-agent-xxx/xxxx.socket</code>. However, with <code>S.gpg-agent.ssh</code> in a fixed place, it can be used as the ssh-agent in shell rc files.</p>
<h5 id="use-ssh-agent">Use ssh-agent<a class="headerlink" href="#use-ssh-agent" title="Permanent link">⚓︎</a></h5>
<p>You should now be able to use <code>ssh -A remote</code> on the <em>local</em> host to log into <em>remote</em> host, and should then be able to use YubiKey as if it were connected to the remote host. For example, using e.g. <code>ssh-add -l</code> on that remote host will show the public key from the YubiKey (<code>cardno:</code>). Always use <code>ForwardAgent yes</code> only for a single host, never for all servers.</p>
<h5 id="use-sgpg-agentssh">Use S.gpg-agent.ssh<a class="headerlink" href="#use-sgpg-agentssh" title="Permanent link">⚓︎</a></h5>
<p>First you need to go through <a href="#gnupg-agent-forwarding">GnuPG agent forwarding)</a>, know the conditions for gpg-agent forwarding and know the location of <code>S.gpg-agent.ssh</code> on both the local and the remote.</p>
<p>You may use the command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="gp">$ </span>gpgconf<span class="w"> </span>--list-dirs<span class="w"> </span>agent-ssh-socket
</code></pre></div>
<p>Edit <code>.ssh/config</code> to add the remote host:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="go">Host</span>
<a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="go">  Hostname remote-host.tld</span>
<a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="go">  StreamLocalBindUnlink yes</span>
<a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="go">  RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh</span>
<a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="gp">  # </span>RemoteForward<span class="w"> </span><span class="o">[</span>remote<span class="w"> </span>socket<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="nb">local</span><span class="w"> </span>socket<span class="o">]</span>
<a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="gp">  # </span>Note<span class="w"> </span>that<span class="w"> </span>ForwardAgent<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>wanted<span class="w"> </span>here!
</code></pre></div>
<p>After successfully ssh into the remote host, confirm <code>/run/user/1000/gnupg/S.gpg-agent.ssh</code> exists.</p>
<p>Then in the <em>remote</em> you can type in command line or configure in the shell rc file with:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="go">export SSH_AUTH_SOCK=&quot;/run/user/$UID/gnupg/S.gpg-agent.ssh&quot;</span>
</code></pre></div>
<p>After sourcing the shell rc file, <code>ssh-add -l</code> will return the correct public key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this process no gpg-agent in the remote is involved, hence <code>gpg-agent.conf</code> in the remote is of no use. Also pinentry is invoked locally.</p>
</div>
<h5 id="chained-forwarding">Chained forwarding<a class="headerlink" href="#chained-forwarding" title="Permanent link">⚓︎</a></h5>
<p>If you use <code>ssh-agent</code> provided by OpenSSH and want to forward it into a <em>third</em> box, you can just <code>ssh -A third</code> on the <em>remote</em>.</p>
<p>Meanwhile, if you use <code>S.gpg-agent.ssh</code>, assume you have gone through the steps above and have <code>S.gpg-agent.ssh</code> on the <em>remote</em>, and you would like to forward this agent into a <em>third</em> box, first you may need to configure <code>sshd_config</code> and <code>SSH_AUTH_SOCK</code> of <em>third</em> in the same way as <em>remote</em>, then in the ssh config of <em>remote</em>, add the following lines</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="go">Host third</span>
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="go">  Hostname third-host.tld</span>
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="go">  StreamLocalBindUnlink yes</span>
<a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="go">  RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh</span>
<a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="gp">  #</span>RemoteForward<span class="w"> </span><span class="o">[</span>remote<span class="w"> </span>socket<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="nb">local</span><span class="w"> </span>socket<span class="o">]</span>
<a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="gp">  #</span>Note<span class="w"> </span>that<span class="w"> </span>ForwardAgent<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>wanted<span class="w"> </span>here!
</code></pre></div>
<p>The path must be set according to <code>gpgconf --list-dirs agent-ssh-socket</code> on <em>remote</em> and <em>third</em> hosts.</p>
<h3 id="github">GitHub<a class="headerlink" href="#github" title="Permanent link">⚓︎</a></h3>
<p>YubiKey can be used to sign commits and tags, and authenticate SSH to GitHub when configured in <a href="https://github.com/settings/keys">Settings</a>.</p>
<p>Configure a signing key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="go">git config --global user.signingkey $KEYID</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>The <code>user.email</code> option must match the email address associated with the PGP identity.</p>
</div>
<p>To sign commits or tags, use the <code>-S</code> option.</p>
<p><strong>Windows</strong></p>
<p>Configure authentication:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="go">git config --global core.sshcommand &quot;plink -agent&quot;</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="go">git config --global gpg.program &#39;C:\Program Files (x86)\GnuPG\bin\gpg.exe&#39;</span>
</code></pre></div>
<p>Then update the repository URL to <code>git@github.com:USERNAME/repository</code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the error <code>gpg: signing failed: No secret key</code> - run <code>gpg --card-status</code> with YubiKey plugged in and try the git command again.</p>
</div>
<h2 id="gnupg-agent-forwarding">GnuPG agent forwarding<a class="headerlink" href="#gnupg-agent-forwarding" title="Permanent link">⚓︎</a></h2>
<p>YubiKey can be used sign git commits and decrypt files on remote hosts with GnuPG Agent Forwarding. To ssh through another network, especially to push to/pull from GitHub using ssh, see <a href="#ssh-agent-forwarding">Remote Machines (SSH Agent forwarding)</a>.</p>
<p><code>gpg-agent.conf</code> is not needed on the remote host; after forwarding, remote GnuPG directly communicates with <code>S.gpg-agent</code> without starting <code>gpg-agent</code> on the remote host.</p>
<p>On the remote host, edit <code>/etc/ssh/sshd_config</code> to set <code>StreamLocalBindUnlink yes</code></p>
<div class="admonition abstract">
<p class="admonition-title">Optional</p>
<p>Without root access on the remote host to edit <code>/etc/ssh/sshd_config</code>, socket located at <code>gpgconf --list-dir agent-socket</code> on the remote host will need to be removed before forwarding works. See <a href="https://wiki.gnupg.org/AgentForwarding">AgentForwarding GNUPG wiki page</a> for more information.</p>
</div>
<p>Import the public key on the remote host. On the local host, copy the public keyring to the remote host:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="go">scp ~/.gnupg/pubring.kbx remote:~/.gnupg/</span>
</code></pre></div>
<p>On modern distributions, such as Fedora 30, there is no need to set <code>RemoteForward</code> in <code>~/.ssh/config</code></p>
<h4 id="legacy-distributions">Legacy distributions<a class="headerlink" href="#legacy-distributions" title="Permanent link">⚓︎</a></h4>
<p>On the local host, run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="go">gpgconf --list-dirs agent-extra-socket</span>
</code></pre></div>
<p>This should return a path to agent-extra-socket - <code>/run/user/1000/gnupg/S.gpg-agent.extra</code> - though on older Linux distros (and macOS) it may be <code>/home/&lt;user&gt;/.gnupg/S/gpg-agent.extra</code></p>
<p>Find the agent socket on the <strong>remote</strong> host:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="go">gpgconf --list-dirs agent-socket</span>
</code></pre></div>
<p>This should return a path such as <code>/run/user/1000/gnupg/S.gpg-agent</code></p>
<p>Finally, enable agent forwarding for a given host by adding the following to the local host's <code>~/.ssh/config</code> (agent sockets may differ):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>Host
<a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a>  Hostname remote-host.tld
<a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a>  StreamLocalBindUnlink yes
<a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a>  RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra
<a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a>  #RemoteForward [remote socket] [local socket]
</code></pre></div>
<p>It may be necessary to edit <code>gpg-agent.conf</code> on the <em>local</em> host to add the following information:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>pinentry-program /usr/bin/pinentry-gtk-2
<a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a>extra-socket /run/user/1000/gnupg/S.gpg-agent.extra
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pinentry program starts on the <em>local</em> host, not remote.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>Any pinentry program except <code>pinentry-tty</code> or <code>pinentry-curses</code> may be used. This is because local <code>gpg-agent</code> may start headlessly (by systemd without <code>$GPG_TTY</code> set locally telling which tty it is on), thus failed to obtain the pin. Errors on the remote may be misleading saying that there is <em>IO Error</em>. (Yes, internally there is actually an <em>IO Error</em> since it happens when writing to/reading from tty while finding no tty to use, but for end users this is not friendly.)</p>
</div>
<p>See <a href="https://github.com/drduh/YubiKey-Guide/issues/85">Issue 85</a> for more information and troubleshooting.</p>
<h4 id="chained-gnupg-agent-forwarding">Chained GnuPG agent forwarding<a class="headerlink" href="#chained-gnupg-agent-forwarding" title="Permanent link">⚓︎</a></h4>
<p>Assume you have gone through the steps above and have <code>S.gpg-agent</code> on the <em>remote</em>, and you would like to forward this agent into a <em>third</em> box, first you may need to configure <code>sshd_config</code> of <em>third</em> in the same way as <em>remote</em>, then in the ssh config of <em>remote</em>, add the following lines:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="go">Host third</span>
<a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="go">  Hostname third-host.tld</span>
<a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="go">  StreamLocalBindUnlink yes</span>
<a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="go">  RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent</span>
<a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="gp">  #</span>RemoteForward<span class="w"> </span><span class="o">[</span>remote<span class="w"> </span>socket<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="nb">local</span><span class="w"> </span>socket<span class="o">]</span>
</code></pre></div>
<p>You should change the path according to <code>gpgconf --list-dirs agent-socket</code> on <em>remote</em> and <em>third</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On <em>local</em> you have <code>S.gpg-agent.extra</code> whereas on <em>remote</em> and <em>third</em>, you only have <code>S.gpg-agent</code></p>
</div>
<h3 id="using-multiple-yubikeys">Using multiple YubiKeys<a class="headerlink" href="#using-multiple-yubikeys" title="Permanent link">⚓︎</a></h3>
<p>When a GnuPG key is added to YubiKey using <code>keytocard</code>, the key is deleted from the keyring and a <strong>stub</strong> is added, pointing to the YubiKey. The stub identifies the GnuPG key ID and YubiKey serial number.</p>
<p>When a Subkey is added to an additional YubiKey, the stub is overwritten and will now point to the latest YubiKey. GnuPG will request a specific YubiKey by serial number, as referenced by the stub, and will not recognize another YubiKey with a different serial number.</p>
<p>To scan an additional YubiKey and recreate the correct stub:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="go">gpg-connect-agent &quot;scd serialno&quot; &quot;learn --force&quot; /bye</span>
</code></pre></div>
<p>Alternatively, use a script to delete the GnuPG shadowed key, where the card serial number is stored (see <a href="https://dev.gnupg.org/T2291">GnuPG #T2291</a>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="go">cat &gt;&gt; ~/scripts/remove-keygrips.sh &lt;&lt;EOF</span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="gp">#</span>!/usr/bin/env<span class="w"> </span>bash
<a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="gp gp-VirtualEnv">(( $# )</span><span class="go">) || { echo &quot;Specify a key.&quot; &gt;&amp;2; exit 1; }</span>
<a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="go">KEYGRIPS=$(gpg --with-keygrip --list-secret-keys &quot;$@&quot; | awk &#39;/Keygrip/ { print $3 }&#39;)</span>
<a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a><span class="go">for keygrip in $KEYGRIPS</span>
<a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a><span class="go">do</span>
<a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="go">    rm &quot;$HOME/.gnupg/private-keys-v1.d/$keygrip.key&quot; 2&gt; /dev/null</span>
<a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="go">done</span>
<a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a>
<a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a><span class="go">gpg --card-status</span>
<a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a><span class="go">EOF</span>
<a id="__codelineno-138-12" name="__codelineno-138-12" href="#__codelineno-138-12"></a>
<a id="__codelineno-138-13" name="__codelineno-138-13" href="#__codelineno-138-13"></a><span class="go">chmod +x ~/scripts/remove-keygrips.sh</span>
<a id="__codelineno-138-14" name="__codelineno-138-14" href="#__codelineno-138-14"></a>
<a id="__codelineno-138-15" name="__codelineno-138-15" href="#__codelineno-138-15"></a><span class="go">~/scripts/remove-keygrips.sh $KEYID</span>
</code></pre></div>
<p>See discussion in Issues <a href="https://github.com/drduh/YubiKey-Guide/issues/19">#19</a> and <a href="https://github.com/drduh/YubiKey-Guide/issues/112">#112</a> for more information and troubleshooting steps.</p>
<h3 id="email">Email<a class="headerlink" href="#email" title="Permanent link">⚓︎</a></h3>
<p>YubiKey can be used to decrypt and sign emails and attachments using <a href="https://www.thunderbird.net/">Thunderbird</a>, <a href="https://www.enigmail.net">Enigmail</a> and <a href="http://www.mutt.org/">Mutt</a>. Thunderbird supports OAuth 2 authentication and can be used with Gmail. See <a href="https://ssd.eff.org/en/module/how-use-pgp-linux">this EFF guide</a> for more information. Mutt has OAuth 2 support since version 2.0.</p>
<h4 id="thunderbird">Thunderbird<a class="headerlink" href="#thunderbird" title="Permanent link">⚓︎</a></h4>
<p>Follow <a href="https://wiki.mozilla.org/Thunderbird:OpenPGP:Smartcards#Configure_an_email_account_to_use_an_external_GnuPG_key">instructions on the mozilla wiki</a> to setup your YubiKey with your thunderbird client using the external gpg provider.</p>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>Thunderbird <a href="https://github.com/drduh/YubiKey-Guide/issues/448">fails</a> to decrypt emails if the ASCII <code>armor</code> option is enabled in your <code>~/.gnupg/gpg.conf</code>. If you see the error <code>gpg: [don't know]: invalid packet (ctb=2d)</code> or <code>message cannot be decrypted (there are unknown problems with this encrypted message)</code> simply remove this option from your config file.</p>
</div>
<h4 id="mailvelope">Mailvelope<a class="headerlink" href="#mailvelope" title="Permanent link">⚓︎</a></h4>
<p><a href="https://www.mailvelope.com/en">Mailvelope</a> allows YubiKey to be used with Gmail and others.</p>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>Mailvelope <a href="https://github.com/drduh/YubiKey-Guide/issues/178">does not work</a> with the <code>throw-keyids</code> option set in <code>gpg.conf</code></p>
</div>
<p>On macOS, install gpgme using Homebrew:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="go">brew install gpgme</span>
</code></pre></div>
<p>To allow Chrome to run gpgme, edit <code>~/Library/Application\ Support/Google/Chrome/NativeMessagingHosts/gpgmejson.json</code> to add:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="p">{</span>
<a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gpgmejson&quot;</span><span class="p">,</span>
<a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Integration with GnuPG&quot;</span><span class="p">,</span>
<a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/local/bin/gpgme-json&quot;</span><span class="p">,</span>
<a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stdio&quot;</span><span class="p">,</span>
<a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="w">    </span><span class="nt">&quot;allowed_origins&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="w">        </span><span class="s2">&quot;chrome-extension://kajibbejlbohfaggdiogboambcijhkke/&quot;</span>
<a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="p">}</span>
</code></pre></div>
<p>Edit the default path to allow Chrome to find GnuPG:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="go">sudo launchctl config user path /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</span>
</code></pre></div>
<p>Finally, install the <a href="https://chromewebstore.google.com/detail/mailvelope/kajibbejlbohfaggdiogboambcijhkke">Mailvelope extension</a> from the Chrome web store.</p>
<h4 id="mutt">Mutt<a class="headerlink" href="#mutt" title="Permanent link">⚓︎</a></h4>
<p>Mutt has both CLI and TUI interfaces - the latter provides powerful functions for processing email. In addition, PGP can be integrated such that cryptographic operations can be done without leaving TUI.</p>
<p>To enable GnuPG support, copy <code>/usr/share/doc/mutt/samples/gpg.rc</code></p>
<p>Edit the file to enable options <code>pgp_default_key</code>, <code>pgp_sign_as</code> and <code>pgp_autosign</code></p>
<p><code>source</code> the file in <code>muttrc</code></p>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p><code>pinentry-tty</code> set as the pinentry program in <code>gpg-agent.conf</code> is reported to cause problems with Mutt TUI, because it uses curses. It is recommended to use <code>pinentry-curses</code> or other graphic pinentry program instead.</p>
</div>
<h3 id="keyserver">Keyserver<a class="headerlink" href="#keyserver" title="Permanent link">⚓︎</a></h3>
<p>Public keys can be uploaded to a public server for discoverability:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="go">gpg --send-key $KEYID</span>
<a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>
<a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="go">gpg --keyserver keys.gnupg.net --send-key $KEYID</span>
<a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a>
<a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="go">gpg --keyserver hkps://keyserver.ubuntu.com:443 --send-key $KEYID</span>
</code></pre></div>
<p>Or if <a href="https://keys.openpgp.org/about/usage">uploading to keys.openpgp.org</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="go">gpg --send-key $KEYID | curl -T - https://keys.openpgp.org</span>
</code></pre></div>
<p>The public key URL can also be added to YubiKey (based on <a href="https://datatracker.ietf.org/doc/html/draft-shaw-openpgp-hkp-00">Shaw 2003</a>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="gp">URL=&quot;hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=$</span><span class="o">{</span>KEYID<span class="o">}</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Edit YubiKey with <code>gpg --edit-card</code> and the Admin PIN:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="go">gpg/card&gt; admin</span>
<a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a>
<a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="go">gpg/card&gt; url</span>
<a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="go">URL to retrieve public key: hkps://keyserver.ubuntu.com:443/pks/lookup?op=get&amp;search=0xFF00000000000000</span>
<a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a>
<a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="go">gpg/card&gt; quit</span>
</code></pre></div>
<h2 id="updating-keys">Updating keys<a class="headerlink" href="#updating-keys" title="Permanent link">⚓︎</a></h2>
<p>PGP does not provide <a href="https://en.wikipedia.org/wiki/Forward_secrecy">forward secrecy</a>, meaning a compromised key may be used to decrypt all past messages. Although keys stored on YubiKey are more difficult to exploit, it is not impossible: the key and PIN could be physically compromised, or a vulnerability may be discovered in firmware or in the random number generator used to create keys, for example. Therefore, it is recommended practice to rotate Subkeys periodically.</p>
<p>When a Subkey expires, it can either be renewed or replaced. Both actions require access to the Certify key.</p>
<ul>
<li>
<p>Renewing Subkeys by updating expiration indicates continued possession of the Certify key and is more convenient.</p>
</li>
<li>
<p>Replacing Subkeys is less convenient but potentially more secure: the new Subkeys will <strong>not</strong> be able to decrypt previous messages, authenticate with SSH, etc. Contacts will need to receive the updated public key and any encrypted secrets need to be decrypted and re-encrypted to new Subkeys to be usable. This process is functionally equivalent to losing the YubiKey and provisioning a new one.</p>
</li>
</ul>
<p>Neither rotation method is superior and it is up to personal philosophy on identity management and individual threat modeling to decide which one to use, or whether to expire Subkeys at all. Ideally, Subkeys would be ephemeral: used only once for each unique encryption, signature and authentication event, however in practice that is not really practical nor worthwhile with YubiKey. Advanced users may dedicate an air-gapped machine for frequent credential rotation.</p>
<p>To renew or rotate Subkeys, follow the same process as generating keys: boot to a secure environment, install required software and disable networking.</p>
<p>Connect the portable storage device with the Certify key and identify the disk label.</p>
<p>Decrypt and mount the encrypted volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="go">sudo cryptsetup luksOpen /dev/sdc1 gnupg-secrets</span>
<a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a>
<a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="go">sudo mkdir /mnt/encrypted-storage</span>
<a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a>
<a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="go">sudo mount /dev/mapper/gnupg-secrets /mnt/encrypted-storage</span>
</code></pre></div>
<p>Mount the non-encrypted public partition:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="go">sudo mkdir /mnt/public</span>
<a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a>
<a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="go">sudo mount /dev/sdc2 /mnt/public</span>
</code></pre></div>
<p>Copy the original private key materials to a temporary working directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="go">export GNUPGHOME=$(mktemp -d -t gnupg-$(date +%Y-%m-%d)-XXXXXXXXXX)</span>
<a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a>
<a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="go">cd $GNUPGHOME</span>
<a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a>
<a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a><span class="go">cp -avi /mnt/encrypted-storage/gnupg-*/* $GNUPGHOME</span>
</code></pre></div>
<p>Confirm the identity is available, set the key id and fingerprint:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="go">gpg -K</span>
<a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>
<a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="go">export KEYID=$(gpg -k --with-colons &quot;$IDENTITY&quot; | awk -F: &#39;/^pub:/ { print $5; exit }&#39;)</span>
<a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a>
<a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="go">export KEYFP=$(gpg -k --with-colons &quot;$IDENTITY&quot; | awk -F: &#39;/^fpr:/ { print $10; exit }&#39;)</span>
<a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a>
<a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="go">echo $KEYID $KEYFP</span>
</code></pre></div>
<p>Recall the Certify key passphrase and set it, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="go">export CERTIFY_PASS=ABCD-0123-IJKL-4567-QRST-UVWX</span>
</code></pre></div>
<h3 id="renew-subkeys">Renew Subkeys<a class="headerlink" href="#renew-subkeys" title="Permanent link">⚓︎</a></h3>
<p>Determine the updated expiration, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="go">export EXPIRATION=2026-09-01</span>
<a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a>
<a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="go">export EXPIRATION=2y</span>
</code></pre></div>
<p>Renew the Subkeys:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="go">echo &quot;$CERTIFY_PASS&quot; | gpg --batch --pinentry-mode=loopback \</span>
<a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="go">  --passphrase-fd 0 --quick-set-expire &quot;$KEYFP&quot; &quot;$EXPIRATION&quot; \</span>
<a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="gp">  $</span><span class="o">(</span>gpg<span class="w"> </span>-K<span class="w"> </span>--with-colons<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;/^fpr:/ { print $10 }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;+2&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s2">&quot;\n&quot;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="o">)</span>
</code></pre></div>
<p>Export the updated public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="go">gpg --armor --export $KEYID | sudo tee /mnt/public/$KEYID-$(date +%F).asc</span>
</code></pre></div>
<p>Transfer the public key to the destination host and import it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="go">gpg --import /mnt/public/*.asc</span>
</code></pre></div>
<p>Alternatively, publish to a public key server and download it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="go">gpg --send-key $KEYID</span>
<a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a>
<a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="go">gpg --recv $KEYID</span>
</code></pre></div>
<p>The validity of the GnuPG identity will be extended, allowing it to be used again for encryption and signature operations.</p>
<p>The SSH public key does <strong>not</strong> need to be updated on remote hosts.</p>
<h3 id="rotate-subkeys">Rotate Subkeys<a class="headerlink" href="#rotate-subkeys" title="Permanent link">⚓︎</a></h3>
<p>Follow the original procedure to <a href="#create-subkeys">Create Subkeys</a>.</p>
<p>Previous Subkeys can be deleted from the identity.</p>
<p>Finish by transfering new Subkeys to YubiKey.</p>
<p>Copy the <strong>new</strong> temporary working directory to encrypted storage, which is still mounted:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="go">sudo cp -avi $GNUPGHOME /mnt/encrypted-storage</span>
</code></pre></div>
<p>Unmount and close the encrypted volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="go">sudo umount /mnt/encrypted-storage</span>
<a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a>
<a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="go">sudo cryptsetup luksClose gnupg-secrets</span>
</code></pre></div>
<p>Export the updated public key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="go">sudo mkdir /mnt/public</span>
<a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a>
<a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="go">sudo mount /dev/sdc2 /mnt/public</span>
<a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a>
<a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="go">gpg --armor --export $KEYID | sudo tee /mnt/public/$KEYID-$(date +%F).asc</span>
<a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a>
<a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="go">sudo umount /mnt/public</span>
</code></pre></div>
<p>Remove the storage device and follow the original steps to transfer new Subkeys (<code>4</code>, <code>5</code> and <code>6</code>) to YubiKey, replacing existing ones.</p>
<p>Reboot or securely erase the GnuPG temporary working directory.</p>
<h2 id="reset-yubikey">Reset YubiKey<a class="headerlink" href="#reset-yubikey" title="Permanent link">⚓︎</a></h2>
<p>If PIN attempts are exceeded, the YubiKey is locked and must be <a href="https://developers.yubico.com/ykneo-openpgp/ResetApplet.html">Reset</a> and set up again using the encrypted backup.</p>
<p>Copy the following to a file and run <code>gpg-connect-agent -r $file</code> to lock and terminate the card. Then re-insert YubiKey to complete reset.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="go">/hex</span>
<a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="go">scd serialno</span>
<a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a><span class="go">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="go">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="go">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a><span class="go">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-7" name="__codelineno-159-7" href="#__codelineno-159-7"></a><span class="go">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-8" name="__codelineno-159-8" href="#__codelineno-159-8"></a><span class="go">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-9" name="__codelineno-159-9" href="#__codelineno-159-9"></a><span class="go">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-10" name="__codelineno-159-10" href="#__codelineno-159-10"></a><span class="go">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</span>
<a id="__codelineno-159-11" name="__codelineno-159-11" href="#__codelineno-159-11"></a><span class="go">scd apdu 00 e6 00 00</span>
<a id="__codelineno-159-12" name="__codelineno-159-12" href="#__codelineno-159-12"></a><span class="go">scd apdu 00 44 00 00</span>
<a id="__codelineno-159-13" name="__codelineno-159-13" href="#__codelineno-159-13"></a><span class="go">/echo Card has been successfully reset.</span>
<a id="__codelineno-159-14" name="__codelineno-159-14" href="#__codelineno-159-14"></a><span class="go">/bye</span>
</code></pre></div>
<p>Or use <code>ykman</code> (sometimes in <code>~/.local/bin/</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="gp">$ </span>ykman<span class="w"> </span>openpgp<span class="w"> </span>reset
<a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="go">WARNING! This will delete all stored OpenPGP keys and data and restore factory settings? [y/N]: y</span>
<a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="go">Resetting OpenPGP data, don&#39;t remove your YubiKey...</span>
<a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="go">Success! All data has been cleared and default PINs are set.</span>
<a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="go">PIN:         123456</span>
<a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a><span class="go">Reset code:  NOT SET</span>
<a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a><span class="go">Admin PIN:   12345678</span>
</code></pre></div>
<h2 id="optional-hardening">Optional hardening<a class="headerlink" href="#optional-hardening" title="Permanent link">⚓︎</a></h2>
<p>The following steps may improve the security and privacy of YubiKey.</p>
<h3 id="improving-entropy">Improving entropy<a class="headerlink" href="#improving-entropy" title="Permanent link">⚓︎</a></h3>
<p>Generating cryptographic keys requires high-quality <a href="https://www.random.org/randomness/">randomness</a>, measured as entropy. Most operating systems use software-based pseudorandom number generators or CPU-based hardware random number generators (HRNG).</p>
<p>Optionally, a device such as <a href="https://onerng.info/onerng/">OneRNG</a> may be used to <a href="https://lwn.net/Articles/648550/">increase the speed</a> and possibly the quality of available entropy.</p>
<p>Before creating keys, configure <a href="https://wiki.archlinux.org/title/Rng-tools">rng-tools</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="go">sudo apt -y install at rng-tools python3-gnupg openssl</span>
<a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a>
<a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="go">wget https://github.com/OneRNG/onerng.github.io/raw/master/sw/onerng_3.7-1_all.deb</span>
</code></pre></div>
<p>Verify the package:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="go">sha256sum onerng_3.7-1_all.deb</span>
</code></pre></div>
<p>The value must match:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="go">b7cda2fe07dce219a95dfeabeb5ee0f662f64ba1474f6b9dddacc3e8734d8f57</span>
</code></pre></div>
<p>Install the package:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="go">sudo dpkg -i onerng_3.7-1_all.deb</span>
<a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a>
<a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="go">echo &quot;HRNGDEVICE=/dev/ttyACM0&quot; | sudo tee /etc/default/rng-tools</span>
</code></pre></div>
<p>Insert the device and restart rng-tools:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="go">sudo atd</span>
<a id="__codelineno-165-2" name="__codelineno-165-2" href="#__codelineno-165-2"></a>
<a id="__codelineno-165-3" name="__codelineno-165-3" href="#__codelineno-165-3"></a><span class="go">sudo service rng-tools restart</span>
</code></pre></div>
<h3 id="enable-kdf">Enable KDF<a class="headerlink" href="#enable-kdf" title="Permanent link">⚓︎</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature may not be compatible with older GnuPG versions, especially mobile clients. These incompatible clients will not function because the PIN will always be rejected.</p>
</div>
<p>This step must be completed before changing PINs or moving keys or an error will occur: <code>gpg: error for setup KDF: Conditions of use not satisfied</code></p>
<p>Key Derived Function (KDF) enables YubiKey to store the hash of PIN, preventing the PIN from being passed as plain text.</p>
<p>Enable KDF using the default Admin PIN of <code>12345678</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="go">gpg --command-fd=0 --pinentry-mode=loopback --card-edit &lt;&lt;EOF</span>
<a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="go">admin</span>
<a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="go">kdf-setup</span>
<a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="go">12345678</span>
<a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a><span class="go">EOF</span>
</code></pre></div>
<h3 id="network-considerations">Network considerations<a class="headerlink" href="#network-considerations" title="Permanent link">⚓︎</a></h3>
<p>This section is primarily focused on Debian / Ubuntu based systems, but the same concept applies to any system connected to a network.</p>
<p>Whether you're using a VM, installing on dedicated hardware, or running a Live OS temporarily, start <em>without</em> a network connection and disable any unnecessary services listening on all interfaces before connecting to the network.</p>
<p>The reasoning for this is because services like cups or avahi can be listening by default. While this isn't an immediate problem it simply broadens the attack surface. Not everyone will have a dedicated subnet or trusted network equipment they can control, and for the purposes of this guide, these steps treat <em>any</em> network as untrusted / hostile.</p>
<p><strong>Disable Listening Services</strong></p>
<ul>
<li>Ensures only essential network services are running</li>
<li>If the service doesn't exist you'll get a "Failed to stop" which is fine</li>
<li>Only disable <code>Bluetooth</code> if you don't need it</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>bluetooth<span class="w"> </span>exim4<span class="w"> </span>cups<span class="w"> </span>avahi<span class="w"> </span>avahi-daemon<span class="w"> </span>sshd
</code></pre></div>
<p><strong>Firewall</strong></p>
<p>Enable a basic firewall policy of <em>deny inbound, allow outbound</em>. Note that Debian does not come with a firewall, simply disabling the services in the previous step is fine. The following options have Ubuntu and similar systems in mind.</p>
<p>On Ubuntu, <code>ufw</code> is built in and easy to enable:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a>sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>
</code></pre></div>
<p>On systems without <code>ufw</code>, <code>nftables</code> is replacing <code>iptables</code>. The <a href="https://wiki.nftables.org/wiki-nftables/index.php/Simple_ruleset_for_a_workstation">nftables wiki has examples</a> for a baseline <em>deny inbound, allow outbound</em> policy. The <code>fw.inet.basic</code> policy covers both IPv4 and IPv6.</p>
<p>(Remember to download this README and any other resources to another external drive when creating the bootable media, to have this information ready to use offline)</p>
<p>Regardless of which policy you use, write the contents to a file (e.g. <code>nftables.conf</code>) and apply the policy with the following comand:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a>sudo<span class="w"> </span>nft<span class="w"> </span>-f<span class="w"> </span>./nftables.conf
</code></pre></div>
<p><strong>Review the System State</strong></p>
<p><code>NetworkManager</code> should be the only listening service on port 68/udp to obtain a DHCP lease (and 58/icmp6 if you have IPv6).</p>
<p>If you want to look at every process's command line arguments you can use <code>ps axjf</code>. This prints a process tree which may have a large number of lines but should be easy to read on a live image or fresh install.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a>sudo<span class="w"> </span>ss<span class="w"> </span>-anp<span class="w"> </span>-A<span class="w"> </span>inet<span class="w">    </span><span class="c1"># Dump all network state information</span>
<a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a>ps<span class="w"> </span>axjf<span class="w">                 </span><span class="c1"># List all processes in a process tree</span>
<a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a>ps<span class="w"> </span>aux<span class="w">                  </span><span class="c1"># BSD syntax, list all processes but no process tree</span>
</code></pre></div>
<p>If you find any additional processes listening on the network that aren't needed, take note and disable them with one of the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>&lt;process-name&gt;<span class="w">                      </span><span class="c1"># Stops services managed by systemctl</span>
<a id="__codelineno-171-2" name="__codelineno-171-2" href="#__codelineno-171-2"></a>sudo<span class="w"> </span>pkill<span class="w"> </span>-f<span class="w"> </span><span class="s1">&#39;&lt;process-name-or-command-line-string&gt;&#39;</span><span class="w">   </span><span class="c1"># Terminate the process by matching it&#39;s command line string</span>
<a id="__codelineno-171-3" name="__codelineno-171-3" href="#__codelineno-171-3"></a>pgrep<span class="w"> </span>-f<span class="w"> </span><span class="s1">&#39;&lt;process-name-or-command-line-string&gt;&#39;</span><span class="w">        </span><span class="c1"># Obtain the PID</span>
<a id="__codelineno-171-4" name="__codelineno-171-4" href="#__codelineno-171-4"></a>sudo<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>&lt;pid&gt;<span class="w">                                         </span><span class="c1"># Terminate the process via its PID</span>
</code></pre></div>
<p>Now connect to a network.</p>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">⚓︎</a></h2>
<ol>
<li>
<p>YubiKey has two configurations, invoked with either a short or long press. By default, the short-press mode is configured for HID OTP; a brief touch will emit an OTP string starting with <code>cccccccc</code>. OTP mode can be swapped to the second configuration via the YubiKey Personalization tool or disabled entirely using <a href="https://developers.yubico.com/yubikey-manager">YubiKey Manager</a>: <code>ykman config usb -d OTP</code></p>
</li>
<li>
<p>Using YubiKey for GnuPG does not prevent use of <a href="https://developers.yubico.com/">other features</a>, such as <a href="https://developers.yubico.com/WebAuthn/">WebAuthn</a> and <a href="https://developers.yubico.com/OTP/">OTP</a>.</p>
</li>
<li>
<p>Add additional identities to a Certify key with the <code>adduid</code> command during setup, then trust it ultimately with <code>trust</code> and <code>5</code> to configure for use.</p>
</li>
<li>
<p>To switch between YubiKeys, remove the first YubiKey and restart gpg-agent, ssh-agent and pinentry with <code>pkill "gpg-agent|ssh-agent|pinentry" ; eval $(gpg-agent --daemon --enable-ssh-support)</code> then insert the other YubiKey and run <code>gpg-connect-agent updatestartuptty /bye</code></p>
</li>
<li>
<p>To use YubiKey on multiple computers, import the corresponding public keys, then confirm YubiKey is visible with <code>gpg --card-status</code>. Trust the imported public keys ultimately with <code>trust</code> and <code>5</code>, then <code>gpg --list-secret-keys</code> will show the correct and trusted key.</p>
</li>
</ol>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">⚓︎</a></h2>
<ul>
<li>
<p>Use <code>man gpg</code> to understand GnuPG options and command-line flags.</p>
</li>
<li>
<p>To get more information on potential errors, restart the <code>gpg-agent</code> process with debug output to the console with <code>pkill gpg-agent; gpg-agent --daemon --no-detach -v -v --debug-level advanced --homedir ~/.gnupg</code>.</p>
</li>
<li>
<p>A lot of issues can be fixed by removing and re-inserting YubiKey, or restarting the <code>gpg-agent</code> process.</p>
</li>
<li>
<p>If you receive the error, <code>Yubikey core error: no yubikey present</code> - make sure the YubiKey is inserted correctly. It should blink once when plugged in.</p>
</li>
<li>
<p>If you still receive the error, <code>Yubikey core error: no yubikey present</code> - you likely need to install newer versions of yubikey-personalize as outlined in <a href="#install-software">Install software</a>.</p>
</li>
<li>
<p>If you see <code>General key info..: [none]</code> in card status output - import the public key.</p>
</li>
<li>
<p>If you receive the error, <code>gpg: decryption failed: secret key not available</code> - you likely need to install GnuPG version 2.x. Another possibility is that there is a problem with the PIN, e.g., it is too short or blocked.</p>
</li>
<li>
<p>If you receive the error, <code>Yubikey core error: write error</code> - YubiKey is likely locked. Install and run yubikey-personalization-gui to unlock it.</p>
</li>
<li>
<p>If you receive the error, <code>Key does not match the card's capability</code> - you likely need to use 2048-bit RSA key sizes.</p>
</li>
<li>
<p>If you receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - make sure you replaced <code>ssh-agent</code> with <code>gpg-agent</code> as noted above.</p>
</li>
<li>
<p>If you still receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=835394">run the command</a> <code>gpg-connect-agent updatestartuptty /bye</code></p>
</li>
<li>
<p>If you still receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - edit <code>~/.gnupg/gpg-agent.conf</code> to set a valid <code>pinentry</code> program path. <code>gpg: decryption failed: No secret key</code> could also indicate an invalid <code>pinentry</code> path</p>
</li>
<li>
<p>If you still receive the error, <code>sign_and_send_pubkey: signing failed: agent refused operation</code> - it is a <a href="https://bbs.archlinux.org/viewtopic.php?id=274571">known issue</a> that openssh 8.9p1 and higher has issues with YubiKey. Adding <code>KexAlgorithms -sntrup761x25519-sha512@openssh.com</code> to <code>/etc/ssh/ssh_config</code> often resolves the issue.</p>
</li>
<li>
<p>If you receive the error, <code>The agent has no identities</code> from <code>ssh-add -L</code>, make sure you have installed and started <code>scdaemon</code></p>
</li>
<li>
<p>If you receive the error, <code>Error connecting to agent: No such file or directory</code> from <code>ssh-add -L</code>, the UNIX file socket that the agent uses for communication with other processes may not be set up correctly. On Debian, try <code>export SSH_AUTH_SOCK="/run/user/$UID/gnupg/S.gpg-agent.ssh"</code>. Also see that <code>gpgconf --list-dirs agent-ssh-socket</code> is returning single path, to existing <code>S.gpg-agent.ssh</code> socket.</p>
</li>
<li>
<p>If you receive the error, <code>Permission denied (publickey)</code>, increase ssh verbosity with the <code>-v</code> flag and verify the public key from the card is being offered: <code>Offering public key: RSA SHA256:abcdefg... cardno:00060123456</code>. If it is, verify the correct user the target system - not the user on the local system. Otherwise, be sure <code>IdentitiesOnly</code> is not <a href="https://github.com/FiloSottile/whosthere#how-do-i-stop-it">enabled</a> for this host.</p>
</li>
<li>
<p>If SSH authentication still fails - add up to 3 <code>-v</code> flags to the <code>ssh</code> command to increase verbosity.</p>
</li>
<li>
<p>If it still fails, it may be useful to stop the background <code>sshd</code> daemon process service on the server (e.g. using <code>sudo systemctl stop sshd</code>) and instead start it in the foreground with extensive debugging output, using <code>/usr/sbin/sshd -eddd</code>. Note that the server will not fork and will only process one connection, therefore has to be re-started after every <code>ssh</code> test.</p>
</li>
<li>
<p>If you receive the error, <code>Please insert the card with serial number</code> see <a href="#using-multiple-yubikeys">Using Multiple Keys</a></p>
</li>
<li>
<p>If you receive the error, <code>There is no assurance this key belongs to the named user</code> or <code>encryption failed: Unusable public key</code> or <code>No public key</code> use <code>gpg --edit-key</code> to set <code>trust</code> to <code>5 = I trust ultimately</code></p>
</li>
<li>
<p>If, when you try the above command, you get the error <code>Need the secret key to do this</code> - specify trust for the key in <code>~/.gnupg/gpg.conf</code> by using the <code>trust-key [key ID]</code> directive.</p>
</li>
<li>
<p>If, when using a previously provisioned YubiKey on a new computer with <code>pass</code>, you see the following error on <code>pass insert</code>, you need to adjust the trust associated with the key. See the note above.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a>gpg: 0x0000000000000000: There is no assurance this key belongs to the named user
<a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a>gpg: [stdin]: encryption failed: Unusable public key
</code></pre></div>
<ul>
<li>
<p>If you receive the error, <code>gpg: 0x0000000000000000: skipped: Unusable public key</code>, <code>signing failed: Unusable secret key</code>, or <code>encryption failed: Unusable public key</code> the Subkey may be expired and can no longer be used to encrypt nor sign messages. It can still be used to decrypt and authenticate, however.</p>
</li>
<li>
<p>If the <em>pinentry</em> graphical dialog does not show and this error appears: <code>sign_and_send_pubkey: signing failed: agent refused operation</code>, install the <code>dbus-user-session</code> package and restart for the <code>dbus</code> user session to be fully inherited. This is because <code>pinentry</code> complains about <code>No $DBUS_SESSION_BUS_ADDRESS found</code>, falls back to <code>curses</code> but doesn't find the expected <code>tty</code></p>
</li>
<li>
<p>If, when you try the above <code>--card-status</code> command, you get receive the error, <code>gpg: selecting card failed: No such device</code> or <code>gpg: OpenPGP card not available: No such device</code>, it's possible that the latest release of pcscd now requires polkit rules to operate properly. Create the following file to allow users in the <code>wheel</code> group to use the card. Be sure to restart pcscd when you're done to allow the new rules to take effect.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="go">cat &lt;&lt; EOF &gt;  /etc/polkit-1/rules.d/99-pcscd.rules</span>
<a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="go">polkit.addRule(function(action, subject) {</span>
<a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a><span class="go">        if (action.id == &quot;org.debian.pcsc-lite.access_card&quot; &amp;&amp;</span>
<a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a><span class="go">                subject.isInGroup(&quot;wheel&quot;)) {</span>
<a id="__codelineno-173-5" name="__codelineno-173-5" href="#__codelineno-173-5"></a><span class="go">                return polkit.Result.YES;</span>
<a id="__codelineno-173-6" name="__codelineno-173-6" href="#__codelineno-173-6"></a><span class="go">        }</span>
<a id="__codelineno-173-7" name="__codelineno-173-7" href="#__codelineno-173-7"></a><span class="go">});</span>
<a id="__codelineno-173-8" name="__codelineno-173-8" href="#__codelineno-173-8"></a><span class="go">polkit.addRule(function(action, subject) {</span>
<a id="__codelineno-173-9" name="__codelineno-173-9" href="#__codelineno-173-9"></a><span class="go">        if (action.id == &quot;org.debian.pcsc-lite.access_pcsc&quot; &amp;&amp;</span>
<a id="__codelineno-173-10" name="__codelineno-173-10" href="#__codelineno-173-10"></a><span class="go">                subject.isInGroup(&quot;wheel&quot;)) {</span>
<a id="__codelineno-173-11" name="__codelineno-173-11" href="#__codelineno-173-11"></a><span class="go">                return polkit.Result.YES;</span>
<a id="__codelineno-173-12" name="__codelineno-173-12" href="#__codelineno-173-12"></a><span class="go">        }</span>
<a id="__codelineno-173-13" name="__codelineno-173-13" href="#__codelineno-173-13"></a><span class="go">});</span>
<a id="__codelineno-173-14" name="__codelineno-173-14" href="#__codelineno-173-14"></a><span class="go">EOF</span>
</code></pre></div>
<ul>
<li>
<p>If the public key is lost, follow <a href="https://www.nicksherlock.com/2021/08/recovering-lost-gpg-public-keys-from-your-yubikey/">this guide</a> to recover it from YubiKey.</p>
</li>
<li>
<p>Refer to Yubico article <a href="https://support.yubico.com/hc/en-us/articles/360013714479-Troubleshooting-Issues-with-GPG">Troubleshooting Issues with GPG</a> for additional guidance.</p>
</li>
</ul>
<h2 id="alternative-solutions">Alternative solutions<a class="headerlink" href="#alternative-solutions" title="Permanent link">⚓︎</a></h2>
<ul>
<li><a href="https://github.com/vorburger/vorburger.ch-Notes/blob/develop/security/ed25519-sk.md"><code>vorburger/ed25519-sk.md</code></a> - use YubiKey for SSH without GnuPG</li>
<li><a href="https://github.com/smlx/piv-agent"><code>smlx/piv-agent</code></a> - SSH and GnuPG agent which can be used with PIV devices</li>
<li><a href="https://www.gnupg.org/documentation/manuals/gnupg/OpenPGP-Key-Management.html"><code>keytotpm</code></a> - use GnuPG with TPM systems</li>
</ul>
<h2 id="additional-resources">Additional resources<a class="headerlink" href="#additional-resources" title="Permanent link">⚓︎</a></h2>
<ul>
<li><a href="https://developers.yubico.com/PGP/">Yubico - PGP</a></li>
<li><a href="https://developers.yubico.com/yubikey-personalization/">Yubico - Yubikey Personalization</a></li>
<li><a href="https://rgoulter.com/blog/posts/programming/2022-06-10-a-visual-explanation-of-gpg-subkeys.html">A Visual Explanation of GPG Subkeys (2022)</a></li>
<li><a href="https://github.com/dhess/nixos-yubikey">dhess/nixos-yubikey</a></li>
<li><a href="https://gitlab.com/lsasolutions/makegpg">lsasolutions/makegpg</a></li>
<li><a href="https://trmm.net/Yubikey">Trammell Hudson - Yubikey (2020)</a></li>
<li><a href="https://blog.onefellow.com/post/180065697833/yubikey-forwarding-ssh-keys">Yubikey forwarding SSH keys (2019)</a></li>
<li><a href="https://mlohr.com/gpg-agent-forwarding/">GPG Agent Forwarding (2018)</a></li>
<li><a href="https://evilmartians.com/chronicles/stick-with-security-yubikey-ssh-gnupg-macos">Stick with security: YubiKey, SSH, GnuPG, macOS (2018)</a></li>
<li><a href="https://www.esev.com/blog/post/2015-01-pgp-ssh-key-on-yubikey-neo/">PGP and SSH keys on a Yubikey NEO (2015)</a></li>
<li><a href="https://blog.josefsson.org/2014/06/23/offline-gnupg-master-key-and-subkeys-on-yubikey-neo-smartcard/">Offline GnuPG Master Key and Subkeys on YubiKey NEO Smartcard (2014)</a></li>
<li><a href="https://alexcabal.com/creating-the-perfect-gpg-keypair/">Creating the perfect GPG keypair (2013)</a></li>
</ul>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-03-03T20:40:14+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-03</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-03-03T20:40:14+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-03-03</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/FlagHunter01" class="md-author" title="@FlagHunter01">
          
          <img src="../../assets/external/avatars.githubusercontent.com/u/32909577.fe356448.png" alt="FlagHunter01">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="misc.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Miscellaneous">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Miscellaneous
              </div>
            </div>
          </a>
        
        
          
          <a href="../../misc/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: Miscellaneous">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Miscellaneous
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/FlagHunter01" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.instant.preview", "navigation.tracking", "navigation.tabs", "navigation.path", "navigation.indexes", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "content.action.view", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "content.footnote.tooltips", "content.tooltips"], "search": "../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d249fdc4.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>